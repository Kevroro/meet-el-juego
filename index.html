<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Meet â€” Juego de preguntas optimizado, accesible y responsivo" />

  <!-- Texto que dispara el popup de versiÃ³n: edÃ­talo para notificar a los usuarios.
       Ejemplo: content="Nueva versiÃ³n v1.2 â€” Mejoras en UX" -->
  <meta name="app-version" content="Nueva versiÃ³n">

  <title>Meet â€” DÃ©jate llevar</title>

  <!-- Mantengo Tailwind si lo usas; no es obligatorio. -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat&family=Comfortaa:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0b;
      --panel-grad1:#0d1e75;
      --panel-grad2:#9a18a4;
      --muted:#9CA3AF;
      --accent:#7C3AED;
      --accent-2:#9a18a4;
      --success:#10B981;
      --danger:#EF4444;
      --white:#FFFFFF;
      --max-players:12;
      --max-score:100;
    }

    /* Theme (overridable) */
    :root.light{
      --bg:#f6f7fb;
      --white:#0b0b0b;
      --muted:#374151;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--white);
      font-family: 'Comfortaa', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      -webkit-overflow-scrolling:touch;
      transition:background .18s linear, color .18s linear;
    }

    .sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    /* Layout */
    .screen{ position:fixed; inset:0; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:1.25rem; gap:.75rem; transition:opacity .22s ease, transform .22s ease; }
    .hidden-screen{ opacity:0; pointer-events:none; transform:translateY(6px) scale(.998); }
    .visible-screen{ opacity:1; pointer-events:auto; transform:none; }

    /* Splash */
    #splash-screen{ background:var(--white); display:flex; gap:1rem; flex-direction:column; justify-content:center; align-items:center; }
    #splash-screen img{ width:40%; max-width:260px; height:auto; }

    h1,h2{ font-family: 'Caveat', cursive; text-align:center; margin:0; color:inherit }
    h1{ font-size:2.25rem } @media(min-width:768px){ h1{ font-size:3rem } }

    /* Inputs */
    .input {
      width:280px; max-width:92vw;
      padding:.6rem .9rem; border-radius:.6rem;
      border:1px solid rgba(255,255,255,.08);
      font-size:1rem; color:#111;
      background:#fff;
    }

    .btn {
      display:inline-flex; align-items:center; gap:.5rem;
      padding:.6rem 1rem; border-radius:.7rem; border:none; cursor:pointer;
      background:linear-gradient(90deg,var(--panel-grad1),var(--panel-grad2));
      color:var(--white); font-weight:700; box-shadow:0 8px 22px rgba(15,12,50,.28);
    }
    .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,.06) }

    .icon-circle{
      width:44px;height:44px;border-radius:999px;display:grid;place-items:center;
      background:linear-gradient(90deg,#ffffff12,#ffffff06);
      color:var(--white); font-weight:700;
    }

    /* Question panel */
    .question-box{
      background: linear-gradient(145deg, var(--panel-grad1), var(--panel-grad2));
      min-height:14rem; display:flex; flex-direction:column; justify-content:center; align-items:center;
      border-radius:1rem; padding:1.25rem; width:100%; max-width:760px; text-align:center; box-shadow:0 12px 40px rgba(0,0,0,.6);
    }
    .emoji{ font-size:1.9rem; margin-bottom:.25rem }
    #question{ font-family:'Caveat', cursive; font-size:1.25rem; margin:0 .5rem 1rem; line-height:1.25; color:var(--white) }

    /* Scores */
    #player-scores{ width:100%; max-width:460px; margin-top:1rem }
    .player-row{ display:flex; align-items:center; gap:.5rem; justify-content:space-between; margin-bottom:.7rem }
    .player-name{ font-weight:700; text-transform:uppercase; letter-spacing:.03em; color:var(--white) }
    .controls button{ background:transparent;border:none;color:var(--white);font-size:1.15rem;padding:.25rem;cursor:pointer }
    .controls button:focus{ outline:3px solid rgba(16,185,129,.16); border-radius:.3rem }

    .progress-outer{ background:rgba(255,255,255,.06); height:12px; border-radius:999px; overflow:hidden; flex:1; margin:0 0.75rem }
    .progress-inner{ height:100%; background:linear-gradient(90deg,var(--panel-grad1),var(--panel-grad2)); width:0%; transition:width .36s cubic-bezier(.2,.9,.2,1) }

    /* Version popup */
    .version-popup{ position:fixed; top:1rem; left:50%; transform:translateX(-50%) translateY(-8px); background:linear-gradient(90deg,var(--panel-grad1),var(--panel-grad2)); color:var(--white); padding:.9rem 1.1rem; border-radius:.8rem; box-shadow:0 12px 30px rgba(0,0,0,.45); z-index:1200; display:flex; gap:.75rem; align-items:center; opacity:0; pointer-events:none; transition:opacity .24s ease, transform .24s cubic-bezier(.2,.9,.2,1) }
    .version-popup.show{ opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(0) }

    footer{ position:fixed; bottom:1rem; width:100%; text-align:center; color:var(--muted); font-size:.85rem }

    /* Toasts (accesible) */
    .toast-wrap{ position:fixed; right:1rem; bottom:1rem; display:flex; flex-direction:column; gap:.5rem; z-index:1250; }
    .toast{ min-width:220px; max-width:320px; padding:.6rem .9rem; border-radius:.6rem; color:var(--white); box-shadow:0 10px 30px rgba(0,0,0,.25); display:flex; gap:.6rem; align-items:center; opacity:0; transform:translateY(12px); transition:opacity .28s ease, transform .28s cubic-bezier(.2,.9,.2,1) }
    .toast.show{ opacity:1; transform:translateY(0) }
    .toast.info{ background:linear-gradient(90deg,var(--panel-grad1),var(--panel-grad2)) }
    .toast.success{ background:linear-gradient(90deg,#059669,#10b981) }
    .toast.warn{ background:#f59e0b }
    .toast.error{ background:linear-gradient(90deg,#ef4444,#ef7f7f) }
    .toast button{ background:transparent;border:none;color:inherit;font-weight:700;cursor:pointer }

    /* Small screens */
    @media (max-width:600px){
      h1{ font-size:1.8rem }
      .input{ width:92vw }
      .question-box{ padding:1rem }
    }
  </style>
</head>
<body>
  <!-- Popup de versiÃ³n: texto controlado por <meta name="app-version"> -->
  <div id="versionPopup" class="version-popup" role="status" aria-live="polite" aria-atomic="true" aria-hidden="true">
    <div id="versionText" style="font-weight:700;">Nueva versiÃ³n</div>
    <button id="closeVersion" aria-label="Aceptar aviso">Aceptar</button>
    <span class="sr-only" id="versionAnnounce"></span>
  </div>

  <!-- Contenedor de toasts accesibles -->
  <div class="toast-wrap" id="toastWrap" aria-live="polite" aria-atomic="true"></div>

  <!-- Pantalla splash -->
  <main id="splash-screen" class="screen visible-screen" role="dialog" aria-labelledby="splash-title" aria-hidden="false">
    <img src="logo.png" alt="Logotipo de la aplicaciÃ³n" loading="lazy" />
    <h2 id="splash-title" class="sr-only">Pantalla de carga</h2>
  </main>

  <!-- Player setup -->
  <section id="player-setup" class="screen hidden-screen" role="region" aria-labelledby="players-title" aria-hidden="true">
    <h1 id="players-title">Â¿QuiÃ©nes vais a dejaros llevar?</h1>

    <form id="players-form" class="flex flex-col items-center gap-4" onsubmit="return false;">
      <p id="players-desc" class="sr-only">AÃ±ade los nombres de las personas que jugarÃ¡n. MÃ­nimo 1.</p>

      <div id="player-inputs" class="flex flex-col items-center gap-2" aria-live="polite">
        <input inputmode="text" aria-label="Nombre jugador 1" class="input player-name" type="text" placeholder="Nombre 1" />
        <input inputmode="text" aria-label="Nombre jugador 2" class="input player-name" type="text" placeholder="Nombre 2" />
      </div>

      <div class="flex items-center gap-3">
        <button id="add-player" type="button" title="AÃ±adir jugador" aria-label="AÃ±adir jugador" class="ghost" >
          <span class="icon-circle">+</span>
        </button>

        <a href="instrucciones.html" target="_blank" rel="noopener" class="text-white underline">Instrucciones</a>

        <button id="start-game" type="button" class="btn" aria-label="Empezar juego">Empezar</button>
      </div>

      <div class="flex gap-2 mt-2">
        <button id="themeToggle" type="button" class="ghost" aria-pressed="false" title="Cambiar tema">Tema</button>
        <button id="resetVersion" type="button" class="ghost" title="Resetear popup de versiÃ³n (solo testing)">Resetar aviso</button>
      </div>
    </form>
  </section>

  <!-- Category setup -->
  <section id="category-setup" class="screen hidden-screen" role="region" aria-labelledby="cat-title" aria-hidden="true">
    <h1 id="cat-title">Â¿En quÃ© mood estÃ¡is hoy?</h1>

    <fieldset aria-describedby="cat-desc" style="border:none;margin-top:12px">
      <legend id="cat-desc" class="sr-only">Elige una o mÃ¡s categorÃ­as</legend>

      <div class="flex flex-col gap-3 items-start mb-6">
        <label class="flex items-center gap-3"><input type="checkbox" class="category-checkbox" value="love" aria-label="RomÃ¡ntico"> <span>RomÃ¡ntico â¤ï¸</span></label>
        <label class="flex items-center gap-3"><input type="checkbox" class="category-checkbox" value="sexual" aria-label="Sexual"> <span>Sexual ğŸ”¥</span></label>
        <label class="flex items-center gap-3"><input type="checkbox" class="category-checkbox" value="funny" aria-label="Divertido"> <span>Divertido ğŸ¤ª</span></label>
        <label class="flex items-center gap-3"><input type="checkbox" class="category-checkbox" value="intense" aria-label="Intenso"> <span>Intenso ğŸ¤¯</span></label>

        <label class="flex items-center gap-3"><input id="select-all" type="checkbox" value="all" aria-label="Seleccionar todas las categorÃ­as"> <span>Â¡Vamos a por todas! ğŸ‰</span></label>
      </div>

      <button id="apply-categories" type="button" class="btn" aria-label="Aplicar categorÃ­as y continuar">Continuar</button>
    </fieldset>
  </section>

  <!-- Game screen -->
  <section id="game-screen" class="screen hidden-screen" role="main" aria-labelledby="game-title" aria-hidden="true">
    <img src="logoblanco.png" alt="Logotipo blanco" class="w-32 mb-4" loading="lazy" />
    <div class="question-box" aria-labelledby="question">
      <div id="emoji" class="emoji" aria-hidden="true"></div>
      <p id="question" aria-live="polite">Â¡Clica en Â«DÃ©jate llevarÂ» para comenzar la experiencia!</p>
      <button id="new-question" class="btn" aria-label="Nueva pregunta">DÃ©jate llevar</button>
    </div>

    <aside id="player-scores" aria-live="polite" aria-atomic="true" class="text-center mt-4 w-full max-w-md"></aside>
  </section>

  <footer>
    <p class="text-gray-400 text-sm italic">&copy; 2025 Propiedad de Kevin RoldÃ¡n y Judith Sancerni</p>
  </footer>

  <script>
  (function(){
    'use strict';

    // ---------- CONFIG ----------
    const MAX_PLAYERS = 12;
    const MAX_SCORE = 100;

    // ELEMENTOS
    const splash = document.getElementById('splash-screen');
    const playerSetup = document.getElementById('player-setup');
    const categorySetup = document.getElementById('category-setup');
    const gameScreen = document.getElementById('game-screen');
    const playerInputs = document.getElementById('player-inputs');
    const addPlayerBtn = document.getElementById('add-player');
    const startBtn = document.getElementById('start-game');
    const applyCategoriesBtn = document.getElementById('apply-categories');
    const selectAll = document.getElementById('select-all');
    const newQuestionBtn = document.getElementById('new-question');
    const playerScores = document.getElementById('player-scores');

    const versionPopup = document.getElementById('versionPopup');
    const versionTextEl = document.getElementById('versionText');
    const closeVersionBtn = document.getElementById('closeVersion');

    const toastWrap = document.getElementById('toastWrap') || document.getElementById('toastWrap') /* defensive */;
    const themeToggle = document.getElementById('themeToggle');
    const resetVersionBtn = document.getElementById('resetVersion');

    // ESTADO
    let playerCount = 2;
    let players = [];
    const usedQuestions = new Set();

    // PREGUNTAS (sin modificar el contenido original; mantenidas)
    const questions = [
      { text: "Â¿QuÃ© significa el amor para ti?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿En quÃ© crees que se basa el amor a primera vista?", emoji: "â¤ï¸", category: "love" },
      { text: "CuÃ©ntame sobre tu primer amor.", emoji: "â¤ï¸", category: "love" },
      { text: "Si fueras invisible por un dÃ­a, Â¿quÃ© harÃ­as?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CÃ³mo te consideras en la cama?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© parte de tu cuerpo consideras mÃ¡s atractiva?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Si fueras rico/a, Â¿quÃ© harÃ­as con tu fortuna?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras tener cualquier superpoder, Â¿cuÃ¡l escogerÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras teletransportarte, Â¿a dÃ³nde irÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿CuÃ¡l es tu mayor miedo y por quÃ©?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CÃ³mo te gustarÃ­a morir?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CuÃ¡l consideras que es el sentido de la vida?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© harÃ­as por amor?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Te consideras una persona romÃ¡ntica? Â¿Por quÃ©?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CÃ³mo serÃ­a tu cita perfecta?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© piensas sobre el concepto de amor eterno?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Te gustarÃ­a tener una relaciÃ³n a larga distancia? Â¿Por quÃ©?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CuÃ¡l es tu mayor temor en una relaciÃ³n?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© valoras mÃ¡s en una pareja?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CuÃ¡l es tu fantasÃ­a sexual mÃ¡s secreta?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CÃ³mo describirÃ­as la quÃ­mica perfecta entre dos personas?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© opinas sobre el sexo sin compromiso?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CuÃ¡l es tu juguete sexual favorito?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Te gustarÃ­a probar cosas nuevas en la intimidad? Â¿QuÃ© tipo?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Te consideras un buen amante? Â¿Por quÃ©?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© harÃ­as si te tocaran un tema sexual incÃ³modo?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Si fueras un superhÃ©roe, Â¿cuÃ¡l serÃ­a tu poder?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿CuÃ¡l es el peor chiste que conoces?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras ser cualquier animal por un dÃ­a, Â¿cuÃ¡l serÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿QuÃ© harÃ­as si pudieras hablar con los animales?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿QuÃ© harÃ­as si fueras un niÃ±o otra vez por un dÃ­a?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿Te has reÃ­do alguna vez en una situaciÃ³n inapropiada?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras ser famoso por algo ridÃ­culo, Â¿quÃ© harÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿CuÃ¡l es tu imitaciÃ³n de voz mÃ¡s graciosa?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si fueras un personaje de dibujos animados, Â¿quiÃ©n serÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿QuÃ© opinas sobre el destino? Â¿Crees que todo pasa por una razÃ³n?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© harÃ­as si supieras que te queda solo un dÃ­a de vida?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿Te gustarÃ­a saber cuÃ¡ndo vas a morir?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© opinas sobre el concepto de libertad?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CuÃ¡l es el mayor sacrificio que has hecho en tu vida?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿Crees que hay vida despuÃ©s de la muerte?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© harÃ­as si tuvieras el poder de cambiar el mundo?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© significa para ti la libertad?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© es lo que mÃ¡s te gusta hacer con tu pareja?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CuÃ¡l es tu recuerdo mÃ¡s bonito de un amor?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Tienes alguna cita famosa sobre el amor que te guste?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CÃ³mo te gustarÃ­a que fuera tu boda ideal?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CuÃ¡l es el detalle mÃ¡s bonito que has recibido de un ser querido?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Crees que el amor puede sanar heridas emocionales?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© tipo de abrazos te gustan mÃ¡s?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© harÃ­as si alguien te declarara su amor de una forma muy original?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© significa para ti el amor verdadero?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© opinas sobre las sorpresas romÃ¡nticas?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CuÃ¡l es tu canciÃ³n romÃ¡ntica favorita y por quÃ©?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Prefieres las muestras de cariÃ±o en pÃºblico o en privado? Â¿Por quÃ©?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CÃ³mo fue la vez que te enamoraste de alguien que no esperabas?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© significa para ti una relaciÃ³n saludable?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CuÃ¡l ha sido el gesto mÃ¡s romÃ¡ntico que has hecho por alguien?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© tipo de regalos sentimentales te gustan mÃ¡s?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CuÃ¡l es la cualidad mÃ¡s atractiva que buscas en una pareja?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© harÃ­as si te enamoras de alguien con quien no puedes estar?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© importancia le das a la lealtad en una relaciÃ³n?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CÃ³mo te gustarÃ­a explorar diferentes tipos de sexo?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CÃ³mo te sentirÃ­as si tu pareja te pidiera algo fuera de lo comÃºn en la intimidad?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Hay alguna prÃ¡ctica que jamÃ¡s harÃ­as en la cama?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CÃ³mo te sentirÃ­as si tuvieses que experimentar sexo en lugares pÃºblicos?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Prefieres que la intimidad sea lenta o rÃ¡pida? Â¿Por quÃ©?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Has tenido alguna vez un sueÃ±o erÃ³tico? Â¿CÃ³mo fue?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© es lo que mÃ¡s te excita en la intimidad?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© opinas sobre las pelÃ­culas para adultos?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Te consideras una persona atrevida en la intimidad? Â¿Por quÃ©?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CuÃ¡l es tu fantasÃ­a sexual mÃ¡s atrevida?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© piensas de la sexualidad abierta?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CÃ³mo te gustarÃ­a que fuera una noche de pasiÃ³n perfecta?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Prefieres el sexo suave o mÃ¡s intenso? Â¿QuÃ© te atrae de cada uno?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© importancia le das a la atracciÃ³n por personas del mismo sexo?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Tienes alguna preferencia por algÃºn tipo de ropa en la intimidad?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© harÃ­as si un desconocido te hiciera una propuesta sexual?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CÃ³mo describirÃ­as una relaciÃ³n sexual ideal para ti?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Prefieres tener sexo con emociÃ³n o relajado? Â¿Por quÃ©?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Si fueras una celebridad por un dÃ­a, Â¿quÃ© harÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿CuÃ¡l es la comida mÃ¡s rara que te gusta comer?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras vivir en una pelÃ­cula, Â¿cuÃ¡l escogerÃ­as y por quÃ©?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿QuÃ© superpoder elegirÃ­as para hacerle bromas a la gente?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿Te atreverÃ­as a cantar en pÃºblico en un karaoke? Â¿Por quÃ©?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si fueras un personaje de Disney, Â¿quiÃ©n serÃ­as y por quÃ©?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿Te has caÃ­do alguna vez de una forma muy graciosa? Â¿CÃ³mo fue?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿CuÃ¡l es el peor apodo que te han puesto y cÃ³mo lo tomaste?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras vivir en cualquier Ã©poca, Â¿cuÃ¡l escogerÃ­as y por quÃ©?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si fueras un detective, Â¿quÃ© tipo de crimen resolverÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿Te gustarÃ­a tener una mascota exÃ³tica? Â¿CuÃ¡l?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿Tienes alguna manÃ­a rara? Â¿CuÃ¡l?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si fueras un inventor, Â¿quÃ© inventarÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si fueras invisible por un dÃ­a, Â¿a quÃ© persona espiarÃ­as y por quÃ©?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿QuÃ© harÃ­as si te encuentras con tu â€˜yoâ€™ del futuro?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras tener cualquier habilidad inÃºtil, Â¿cuÃ¡l elegirÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿Te atreverÃ­as a comer algo extremadamente picante?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras tener un animal como compaÃ±ero de trabajo, Â¿cuÃ¡l escogerÃ­as?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿Te gustarÃ­a tener un doble para que haga las tareas aburridas?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Si pudieras cambiar de lugar con alguien por un dÃ­a, Â¿quiÃ©n serÃ­as y por quÃ©?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿QuÃ© significa para ti la felicidad?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© harÃ­as si pudieras cambiar un evento histÃ³rico?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿Te gustarÃ­a saber todos los secretos del universo?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© es lo mÃ¡s valioso para ti en la vida?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© piensas sobre el sufrimiento humano?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© opinas sobre la religiÃ³n?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿Crees que el tiempo es relativo?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CuÃ¡l es tu concepto de libertad?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© cambiarÃ­as en la sociedad para mejorarla?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© opinas sobre el destino y la suerte?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Si murieras maÃ±ana, Â¿quÃ© harÃ­as hoy?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© es lo mÃ¡s ridÃ­culo que has hecho estando borraxe?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Di algo que haga una persona que te genere confianza.", emoji: "â¤ï¸", category: "love" },
      { text: "Di una cosa que cogerÃ­as y otra que descartarÃ­as de les integrantes de la mesa.", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© es lo que nunca te gustarÃ­a probar en la cama?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© objeto salvarÃ­as de un incendio?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© es lo que la mayorÃ­a de la gente suele pensar de ti?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Si solo pudieras vivir en una estaciÃ³n del aÃ±o, Â¿cuÃ¡l serÃ­a?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿CuÃ¡ndo fue la Ãºltima vez que lloraste delante de alguien? Â¿Por quÃ©?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© es lo que mejor se te da en la cama?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CuÃ¡l es la parte que consideras mÃ¡s sexy de tu cuerpo?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Si pudieras revivir un momento de tu vida, Â¿cuÃ¡l serÃ­a?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© papel juegan los viajes en tu vida y cuÃ¡l ha sido tu experiencia mÃ¡s impactante?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© crees que es lo que mÃ¡s te ha marcado en tu infancia?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Si maÃ±ana pudieras levantarte disfrutando de una habilidad sexual nueva, Â¿cuÃ¡l serÃ­a?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CuÃ¡l es tu mayor complejo fÃ­sico y quÃ© es lo que mÃ¡s te gusta de ti?", emoji: "â¤ï¸", category: "love" },
      { text: "Si no pudieras hacer lo que estÃ¡s haciendo ahora, Â¿cÃ³mo te gustarÃ­a ganarte la vida?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CuÃ¡l es el mejor recuerdo de tu infancia?", emoji: "â¤ï¸", category: "love" },
      { text: "Di una cosa que creas tener en comÃºn sexualmente con les personas de la mesa.", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Si tuvieras que elegir ahora mismo un/a famoso/a para tener relaciones sexuales, Â¿quiÃ©n serÃ­a?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuiÃ©n te inspira mÃ¡s?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Te gustarÃ­a ser famoso/a? Â¿De quÃ© forma?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© es lo que valoras mÃ¡s de un amigo/a?", emoji: "â¤ï¸", category: "love" },
      { text: "Di una frase para tu lÃ¡pida.", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿CÃ³mo te gustarÃ­a ser recordado/a?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© querrÃ­as que se hiciera con tu cuerpo al morir?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CÃ³mo te sientes respecto a tu relaciÃ³n con tu madre?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿A quÃ© personaje histÃ³rico te gustarÃ­a conocer?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿Con quÃ© tipo de personas jamÃ¡s te llevarÃ­as bien?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CuÃ¡l consideras que serÃ­a la peor muerte de todas?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© cambiarÃ­as de tu presente?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuÃ© dos adjetivos te definen mejor?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿QuÃ© es lo que mÃ¡s echas de menos de tu infancia?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Eres como quieres ser?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿En quÃ© situaciÃ³n estarÃ­as dispuesto/a a mentir?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿BuscarÃ­as ayuda para corregir un problema sexual?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© valoras mÃ¡s, la amistad o la pareja?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Te consideras buena persona?", emoji: "â¤ï¸", category: "love" },
      { text: "Escoge un tatuaje tuyo o de alguien de la mesa y explica su significado.", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿Por quÃ© aspecto de tu vida sexual sientes mÃ¡s gratitud?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿CuÃ¡ndo fue la Ãºltima vez que te masturbaste?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© sueles pensar cuando alguien se te queda mirando?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿QuÃ© tipos de vÃ­deos hot ves mÃ¡s?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© es lo primero que haces al despertar?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Completa esta frase: OjalÃ¡ tuviera a alguien con quien compartir...", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Has grabado alguna vez un video Ã­ntimo?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿HarÃ­as cibersexo?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© es lo que mÃ¡s te gusta que te hagan en la cama?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© te parecerÃ­a importante destacar en tu carta de presentaciÃ³n?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿QuiÃ©n crees que tiene una idea errÃ³nea de cÃ³mo eres? Â¿CuÃ¡l es?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿Hay algo que te parezca demasiado serio como para no hacer bromas al respecto?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CuÃ¡l es la parte mÃ¡s sensible de tu cuerpo?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Cuando algo no te apetece, Â¿sabes poner lÃ­mites?", emoji: "â¤ï¸", category: "love" },
      { text: "Â¿Te consideras dominante/a en la cama?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿Has tenido relaciones sexuales con personas desconocidas?", emoji: "ğŸ”¥", category: "sexual" },
      { text: "Â¿QuÃ© es lo mÃ¡s alocado que has hecho?", emoji: "ğŸ¤ª", category: "funny" },
      { text: "Â¿A quÃ© le tienes un miedo irracional?", emoji: "ğŸ¤¯", category: "intense" },
      { text: "Â¿CÃ³mo te sentirÃ­as si pillaras a tu pareja dÃ¡ndose autoplacer?", emoji: "ğŸ”¥", category: "sexual" }
    ];

    // ---------- HELPERS: toasts accesibles ----------
    function showToast(message, type='info', timeout=3500){
      const id = 't'+Date.now();
      const el = document.createElement('div');
      el.className = `toast ${type}`;
      el.setAttribute('role','status');
      el.setAttribute('aria-live','polite');
      el.id = id;
      el.innerHTML = `<div style="flex:1">${escapeHtml(message)}</div><button aria-label="Cerrar mensaje">X</button>`;
      toastWrap.appendChild(el);
      // animate in
      requestAnimationFrame(()=> el.classList.add('show'));
      // close on click
      el.querySelector('button').addEventListener('click', ()=> removeToast(el));
      // autoremove
      const t = setTimeout(()=> removeToast(el), timeout);
      // cleanup func
      function removeToast(node){
        clearTimeout(t);
        node.classList.remove('show');
        setTimeout(()=> node.remove(), 320);
      }
    }
    function escapeHtml(str){ return String(str).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[s])) }

    // ---------- UI: screens ----------
    function showScreen(screenEl){
      [splash, playerSetup, categorySetup, gameScreen].forEach(el=>{
        if(el === screenEl){
          el.classList.remove('hidden-screen'); el.classList.add('visible-screen');
          el.setAttribute('aria-hidden','false');
        } else {
          el.classList.remove('visible-screen'); el.classList.add('hidden-screen');
          el.setAttribute('aria-hidden','true');
        }
      });
      // focus management
      setTimeout(()=> {
        const focusable = screenEl.querySelector('button, [tabindex], input, a');
        if(focusable) focusable.focus({preventScroll:true});
      }, 220);
    }

    // ---------- Jugadores ----------
    addPlayerBtn.addEventListener('click', ()=>{
      if(playerInputs.querySelectorAll('.player-name').length >= MAX_PLAYERS){
        showToast(`No puedes aÃ±adir mÃ¡s de ${MAX_PLAYERS} jugadores.`, 'warn');
        return;
      }
      const newIdx = playerInputs.querySelectorAll('.player-name').length + 1;
      const input = document.createElement('input');
      input.type='text'; input.className='input player-name';
      input.placeholder = `Nombre ${newIdx}`; input.setAttribute('aria-label', `Nombre jugador ${newIdx}`);
      playerInputs.appendChild(input);
      input.focus();
    });

    // Enter navigation within player inputs
    playerInputs.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        e.preventDefault();
        const inputs = Array.from(playerInputs.querySelectorAll('.player-name'));
        const idx = inputs.indexOf(e.target);
        if(idx === inputs.length - 1) addPlayerBtn.click();
        else inputs[idx+1].focus();
      }
    });

    startBtn.addEventListener('click', ()=>{
      players = [];
      document.querySelectorAll('.player-name').forEach(i=>{
        const n = i.value.trim();
        if(n) players.push({ name:n, score:0 });
      });
      if(players.length === 0){
        showToast('Introduce al menos un nombre para empezar.', 'warn');
        return;
      }
      showScreen(categorySetup);
    });

    // ---------- CategorÃ­as ----------
    selectAll && selectAll.addEventListener('change', (e)=>{
      const checked = e.target.checked;
      document.querySelectorAll('.category-checkbox').forEach(ch => ch.checked = checked);
    });

    applyCategoriesBtn.addEventListener('click', ()=>{
      const selected = Array.from(document.querySelectorAll('.category-checkbox:checked')).map(c=>c.value);
      if(selected.length === 0){
        showToast('Selecciona al menos una categorÃ­a.', 'warn'); return;
      }
      const filtered = questions.filter(q => selected.includes(q.category));
      if(filtered.length === 0){ showToast('No hay preguntas en las categorÃ­as seleccionadas.', 'error'); return; }
      window.filteredQuestions = filtered.slice();
      usedQuestions.clear();
      showScreen(gameScreen);
      renderScores();
    });

    // ---------- Preguntas ----------
    function pickQuestion(){
      if(!window.filteredQuestions || window.filteredQuestions.length === 0) window.filteredQuestions = questions.slice();
      const avail = window.filteredQuestions.filter(q => !usedQuestions.has(q.text));
      if(avail.length === 0){
        usedQuestions.clear();
        return pickQuestion();
      }
      const q = avail[Math.floor(Math.random()*avail.length)];
      usedQuestions.add(q.text);
      return q;
    }
    newQuestionBtn.addEventListener('click', ()=>{
      const q = pickQuestion();
      if(!q) { showToast('No hay preguntas disponibles.', 'warn'); return; }
      document.getElementById('question').textContent = q.text;
      document.getElementById('emoji').textContent = q.emoji || '';
    });

    // Keyboard shortcut: N = nueva pregunta (mejora de accesibilidad)
    document.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 'n' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){
        e.preventDefault();
        if(!document.getElementById('game-screen').classList.contains('hidden-screen')) newQuestionBtn.click();
      }
    });

    // ---------- Scores ----------
    function renderScores(){
      playerScores.innerHTML = '';
      players.forEach((p, idx) => {
        const row = document.createElement('div'); row.className='player-row';
        const name = document.createElement('div'); name.className='player-name'; name.textContent = `${p.name}: ${p.score}`;
        const progressOuter = document.createElement('div'); progressOuter.className='progress-outer';
        const progressInner = document.createElement('div'); progressInner.className='progress-inner';
        const pct = Math.min(100, Math.round((p.score / MAX_SCORE) * 100));
        progressInner.style.width = pct + '%';
        progressOuter.appendChild(progressInner);

        const controls = document.createElement('div'); controls.className='controls'; controls.setAttribute('role','group');
        const sub = document.createElement('button'); sub.innerHTML='â–'; sub.title = `Restar 10 a ${p.name}`; sub.addEventListener('click', ()=> subtractScore(idx));
        const add = document.createElement('button'); add.innerHTML='â•'; add.title = `Sumar 10 a ${p.name}`; add.addEventListener('click', ()=> addScore(idx));
        controls.appendChild(sub); controls.appendChild(add);

        row.appendChild(name); row.appendChild(progressOuter); row.appendChild(controls);
        playerScores.appendChild(row);
      });
    }

    function addScore(i){
      players[i].score += 10;
      if(players[i].score >= MAX_SCORE){
        showToast(`${players[i].name} llegÃ³ a ${MAX_SCORE}. Â¡Todas habÃ©is ganado! ğŸ’œ`, 'success', 4000);
        setTimeout(()=> location.reload(), 1800);
        return;
      }
      renderScores();
    }
    function subtractScore(i){
      if(players[i].score > 0){
        players[i].score = Math.max(0, players[i].score - 10);
        renderScores();
      } else showToast('La puntuaciÃ³n no puede ser menor a 0', 'warn');
    }

    // ---------- Version popup (localStorage) ----------
    function handleVersionPopup(){
      const meta = document.querySelector('meta[name="app-version"]');
      const text = meta ? meta.getAttribute('content').trim() : '';
      if(!text) return;
      versionTextEl.textContent = text;
      const seen = localStorage.getItem('seenVersion') || '';
      if(seen !== text){
        versionPopup.classList.add('show');
        versionPopup.setAttribute('aria-hidden','false');
        closeVersionBtn.focus();
      }
    }
    closeVersionBtn.addEventListener('click', ()=>{
      const meta = document.querySelector('meta[name="app-version"]');
      const text = meta ? meta.getAttribute('content').trim() : '';
      if(text) localStorage.setItem('seenVersion', text);
      versionPopup.classList.remove('show');
      versionPopup.setAttribute('aria-hidden','true');
    });

    // For testing: reset seenVersion
    resetVersionBtn.addEventListener('click', ()=>{
      localStorage.removeItem('seenVersion');
      showToast('Aviso de versiÃ³n reseteado. Recarga para probar.', 'info');
    });

    // ---------- Theme toggle ----------
    function setTheme(theme){
      if(theme === 'light') document.documentElement.classList.add('light');
      else document.documentElement.classList.remove('light');
      localStorage.setItem('meetTheme', theme);
      if(themeToggle) themeToggle.setAttribute('aria-pressed', theme === 'light' ? 'true' : 'false');
    }
    themeToggle.addEventListener('click', ()=>{
      const cur = localStorage.getItem('meetTheme') || 'dark';
      setTheme(cur === 'dark' ? 'light' : 'dark');
      showToast('Tema cambiado', 'info', 1100);
    });

    // ---------- Init ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      // splash -> players
      showScreen(splash);
      // set theme from storage
      const t = localStorage.getItem('meetTheme') || 'dark';
      setTheme(t);

      handleVersionPopup();
      setTimeout(()=> showScreen(playerSetup), 1400);

      // avoid dblclick zoom on mobile (you had that)
      document.addEventListener('dblclick', (ev)=> ev.preventDefault(), { passive:false });
    });

    // Expose minimal interface for dev/debug
    window.__meet = { showScreen, pickQuestion: ()=> pickQuestion(), players };

  })();
  </script>
</body>
</html>
