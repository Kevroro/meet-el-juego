<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Juego de preguntas optimizado: accesible, responsivo y r√°pido." />

  <!-- Cambia aqu√≠ el texto para forzar el popup en los usuarios.
       P. ej. content="Nueva versi√≥n v1.1 ‚Äî Cambios: mejoras en UX" -->
  <meta name="app-version" content="Nueva versi√≥n">

  <title>Meet ‚Äî D√©jate llevar</title>

  <!-- Tailwind (dejar si te ayuda a mantener clases existentes). 
       Si prefieres quitarlo por rendimiento, b√≥rralo y adapta las clases. -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- Fuentes (preconnect + carga) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat&family=Comfortaa:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    /* ------------------------
       RESET / BASE
    -------------------------*/
    :root{
      --bg:#0b0b0b;
      --panel-grad1:#0d1e75;
      --panel-grad2:#9a18a4;
      --muted:#9CA3AF;
      --accent:#7C3AED;
      --accent-2:#9a18a4;
      --success:#10B981;
      --danger:#EF4444;
      --white:#FFFFFF;
      --max-players:12;
      --max-score:100;
      --font-caveat: 'Caveat', cursive;
      --font-comfortaa: 'Comfortaa', sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--white);
      font-family:var(--font-comfortaa);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      /* permitimos scroll (antes ten√≠as overflow:hidden que romp√≠a accesibilidad) */
      -webkit-overflow-scrolling:touch;
    }

    /* =========================
       LAYOUT: contenedores principales
    ========================== */
    .screen {
      position:fixed;
      inset:0;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding:2rem;
      gap:1rem;
      background:transparent;
      transition:opacity .25s ease, transform .25s ease;
    }

    .screen[aria-hidden="true"] { 
      opacity:0;
      pointer-events:none;
      transform:scale(.995);
    }

    /* Splash */
    #splash-screen{
      background:var(--white);
    }
    #splash-screen img{ width:40%; max-width:280px; height:auto; }

    /* TITLES */
    h1,h2{ font-family:var(--font-caveat); text-align:center }
    h1{ font-size:2.5rem; line-height:1; margin:0 }
    @media (min-width:768px){ h1{ font-size:3.5rem } }

    /* Inputs y botones (limpios, accesibles) */
    .input {
      display:block;
      width:260px;
      max-width:90vw;
      padding:.6rem .9rem;
      border-radius:.5rem;
      border:1px solid rgba(255,255,255,.08);
      font-size:1rem;
      color:#111;
    }

    .btn {
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding:.6rem 1rem;
      border-radius:.6rem;
      background:linear-gradient(90deg,var(--panel-grad1),var(--panel-grad2));
      color:var(--white);
      border:none;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 6px 18px rgba(25,21,71,.35);
    }
    .btn:focus{ outline:3px solid rgba(99,102,241,.25); outline-offset:3px }

    .ghost {
      background:transparent;
      border:1px solid rgba(255,255,255,.08);
      color:var(--white);
    }

    /* A√±adir jugador (c√≠rculo) */
    #add-player {
      width:48px; height:48px; display:inline-grid; place-items:center; border-radius:999px;
      font-size:1.5rem;
      background:linear-gradient(90deg,#ffffff20,#ffffff10);
      color:var(--white);
      border:1px solid rgba(255,255,255,.06);
    }

    /* Panel de pregunta */
    .question-box {
        background: linear-gradient(145deg, var(--panel-grad1), var(--panel-grad2));
        min-height:14rem;
        display:flex;
        flex-direction:column;
        justify-content:center;
        align-items:center;
        border-radius:1rem;
        overflow:hidden;
        padding:1.5rem;
        width:100%;
        max-width:720px;
        text-align:center;
        box-shadow:0 10px 30px rgba(0,0,0,.6);
    }
    .emoji{ font-size:2rem; }
    #question{ font-family:var(--font-caveat); font-size:1.35rem; margin:0 .5rem 1rem; line-height:1.25 }

    /* Listado de jugadores / puntuaciones */
    #player-scores{ width:100%; max-width:420px; margin-top:1rem }
    .player-row{
      display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-bottom:.75rem;
    }
    .player-name{ font-weight:700; letter-spacing:.04em; text-transform:uppercase; color:var(--white) }
    .score-controls button{ background:transparent; border:none; font-size:1.2rem; color:var(--white); padding:.25rem; cursor:pointer }
    .score-controls button:focus{ outline:3px solid rgba(16,185,129,.18); border-radius:.3rem }

    .progress-outer{ background:rgba(255,255,255,.08); height:10px; border-radius:999px; overflow:hidden; flex:1; margin-left:1rem; margin-right:1rem }
    .progress-inner{ height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-2)); width:0%; transition:width .35s ease; }

    /* Popup de versi√≥n (accesible) */
    .version-popup {
      position:fixed;
      top:1rem;
      left:50%;
      transform:translateX(-50%) translateY(-10px);
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:var(--white);
      padding:.9rem 1.1rem;
      border-radius:.8rem;
      box-shadow:0 10px 30px rgba(0,0,0,.45);
      display:flex;
      gap:.75rem;
      align-items:center;
      z-index:1200;
      opacity:0;
      pointer-events:none;
      transition:opacity .28s ease, transform .28s cubic-bezier(.2,.9,.2,1);
    }
    .version-popup.show { opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(0); }
    .version-popup button { background:transparent; border:1px solid rgba(255,255,255,.22); color:var(--white); padding:.35rem .6rem; border-radius:.45rem; cursor:pointer }
    .sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    /* Animaci√≥n sutil al mostrar pantallas */
    .animate-zoom-in { animation: zoomIn .42s ease both; }
    @keyframes zoomIn {
      from { opacity:0; transform:translateY(8px) scale(.995) }
      to { opacity:1; transform:translateY(0) scale(1) }
    }

    footer{ position:fixed; bottom:1.25rem; width:100%; text-align:center; color:var(--muted); font-size:.85rem }
  </style>
</head>
<body>
  <!-- VERSION POPUP: texto configurable en meta[name="app-version"] -->
  <div id="versionPopup" class="version-popup" role="status" aria-live="polite" aria-atomic="true" aria-hidden="true">
    <div id="versionText" style="font-weight:700;">Nueva versi√≥n</div>
    <button id="closeVersion" aria-label="Cerrar aviso de nueva versi√≥n">Aceptar</button>
    <span class="sr-only" id="versionAnnounce"></span>
  </div>

  <!-- Pantalla splash -->
  <main id="splash-screen" class="screen animate-zoom-in" role="dialog" aria-labelledby="splash-title" aria-hidden="false">
    <img src="logo.png" alt="Logotipo de la aplicaci√≥n" loading="lazy" />
    <h2 id="splash-title" class="sr-only">Pantalla de carga</h2>
  </main>

  <!-- Selecci√≥n de jugadores -->
  <section id="player-setup" class="screen" role="region" aria-labelledby="players-title" aria-hidden="true">
    <h1 id="players-title" class="font-caveat">¬øQui√©nes vais a dejaros llevar?</h1>

    <form id="players-form" class="flex flex-col items-center gap-4" onsubmit="return false;" aria-describedby="players-desc">
      <p id="players-desc" class="sr-only">A√±ade los nombres de las personas que jugar√°n. M√≠nimo 1.</p>

      <div id="player-inputs" class="flex flex-col items-center gap-2" aria-live="polite">
        <input inputmode="text" aria-label="Nombre jugador 1" class="input player-name" type="text" placeholder="Nombre 1" />
        <input inputmode="text" aria-label="Nombre jugador 2" class="input player-name" type="text" placeholder="Nombre 2" />
      </div>

      <div class="flex items-center gap-3">
        <button id="add-player" type="button" title="A√±adir jugador" aria-label="A√±adir jugador" class="rounded-full" >
          <!-- simple control visual; estilos gestionados por CSS -->
          <span id="addPlayerIcon" style="display:inline-block;width:44px;height:44px;border-radius:999px;background:linear-gradient(90deg,#ffffff10,#ffffff06);display:grid;place-items:center;color:var(--white);font-weight:700">+</span>
        </button>

        <a href="instrucciones.html" target="_blank" rel="noopener" class="text-white underline">Instrucciones</a>

        <button id="start-game" type="button" class="btn" aria-label="Empezar juego">Empezar</button>
      </div>
    </form>
  </section>

  <!-- Selecci√≥n de categor√≠as -->
  <section id="category-setup" class="screen" role="region" aria-labelledby="cat-title" aria-hidden="true">
    <h1 id="cat-title" class="font-caveat">¬øEn qu√© mood est√°is hoy?</h1>

    <fieldset aria-describedby="cat-desc" style="border:none">
      <legend id="cat-desc" class="sr-only">Elige una o m√°s categor√≠as</legend>

      <div class="flex flex-col gap-3 items-start mb-6">
        <label class="flex items-center gap-3">
          <input type="checkbox" class="category-checkbox" value="love" aria-label="Rom√°ntico" /> <span>Rom√°ntico ‚ù§Ô∏è</span>
        </label>
        <label class="flex items-center gap-3">
          <input type="checkbox" class="category-checkbox" value="sexual" aria-label="Sexual" /> <span>Sexual üî•</span>
        </label>
        <label class="flex items-center gap-3">
          <input type="checkbox" class="category-checkbox" value="funny" aria-label="Divertido" /> <span>Divertido ü§™</span>
        </label>
        <label class="flex items-center gap-3">
          <input type="checkbox" class="category-checkbox" value="intense" aria-label="Intenso" /> <span>Intenso ü§Ø</span>
        </label>

        <label class="flex items-center gap-3">
          <input id="select-all" type="checkbox" value="all" aria-label="Seleccionar todas las categor√≠as" /> <span>¬°Vamos a por todas! üéâ</span>
        </label>
      </div>

      <button id="apply-categories" type="button" class="btn" aria-label="Aplicar categor√≠as y continuar">Continuar</button>
    </fieldset>
  </section>

  <!-- Pantalla de juego -->
  <section id="game-screen" class="screen" role="main" aria-labelledby="game-title" aria-hidden="true">
    <img src="logoblanco.png" alt="Logotipo blanco" class="w-32 mb-4" loading="lazy" />
    <div class="question-box" role="region" aria-labelledby="question">
      <div id="emoji" class="emoji" aria-hidden="true"></div>
      <p id="question" class="font-caveat" aria-live="polite">¬°Clica en ¬´D√©jate llevar¬ª para comenzar la experiencia!</p>
      <button id="new-question" class="btn" aria-label="Nueva pregunta">D√©jate llevar</button>
    </div>

    <aside id="player-scores" aria-live="polite" aria-atomic="true" class="text-center mt-4 w-full max-w-md">
      <!-- Actualizado din√°micamente -->
    </aside>
  </section>

  <footer aria-hidden="false">
    <p class="text-gray-400 text-sm italic">&copy; 2025 Propiedad de Kevin Rold√°n y Judith Sancerni</p>
  </footer>

  <!-- =========================
       SCRIPT: √öNICO, MODULAR Y OPTIMIZADO
       ========================== -->
  <script>
  (function(){
    'use strict';

    /* =========================
       CONFIG / SELECTORES
       ========================== */
    const splash = document.getElementById('splash-screen');
    const playerSetup = document.getElementById('player-setup');
    const categorySetup = document.getElementById('category-setup');
    const gameScreen = document.getElementById('game-screen');
    const playerInputsContainer = document.getElementById('player-inputs');
    const addPlayerBtn = document.getElementById('add-player');
    const startBtn = document.getElementById('start-game');
    const applyCategoriesBtn = document.getElementById('apply-categories');
    const selectAllCheckbox = document.getElementById('select-all');
    const newQuestionBtn = document.getElementById('new-question');
    const playerScoresContainer = document.getElementById('player-scores');

    const versionPopup = document.getElementById('versionPopup');
    const versionTextEl = document.getElementById('versionText');
    const closeVersionBtn = document.getElementById('closeVersion');
    const versionAnnounce = document.getElementById('versionAnnounce');

    const MAX_PLAYERS = 12;
    const MAX_SCORE = 100;

    let playerCount = 2;
    let players = [];
    const usedQuestions = new Set();

    // Guardamos aqu√≠ el array de preguntas (lo mantuve tal cual, sin alterar el contenido)
    const questions = [
      { text: "¬øQu√© significa el amor para ti?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øEn qu√© crees que se basa el amor a primera vista?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "Cu√©ntame sobre tu primer amor.", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "Si fueras invisible por un d√≠a, ¬øqu√© har√≠as?", emoji: "üî•", category: "sexual" },
      { text: "¬øC√≥mo te consideras en la cama?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© parte de tu cuerpo consideras m√°s atractiva?", emoji: "üî•", category: "sexual" },
      { text: "Si fueras rico/a, ¬øqu√© har√≠as con tu fortuna?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras tener cualquier superpoder, ¬øcu√°l escoger√≠as?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras teletransportarte, ¬øa d√≥nde ir√≠as?", emoji: "ü§™", category: "funny" },
      { text: "¬øCu√°l es tu mayor miedo y por qu√©?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øC√≥mo te gustar√≠a morir?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCu√°l consideras que es el sentido de la vida?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© har√≠as por amor?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øTe consideras una persona rom√°ntica? ¬øPor qu√©?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øC√≥mo ser√≠a tu cita perfecta?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© piensas sobre el concepto de amor eterno?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øTe gustar√≠a tener una relaci√≥n a larga distancia? ¬øPor qu√©?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCu√°l es tu mayor temor en una relaci√≥n?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© valoras m√°s en una pareja?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCu√°l es tu fantas√≠a sexual m√°s secreta?", emoji: "üî•", category: "sexual" },
      { text: "¬øC√≥mo describir√≠as la qu√≠mica perfecta entre dos personas?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© opinas sobre el sexo sin compromiso?", emoji: "üî•", category: "sexual" },
      { text: "¬øCu√°l es tu juguete sexual favorito?", emoji: "üî•", category: "sexual" },
      { text: "¬øTe gustar√≠a probar cosas nuevas en la intimidad? ¬øQu√© tipo?", emoji: "üî•", category: "sexual" },
      { text: "¬øTe consideras un buen amante? ¬øPor qu√©?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© har√≠as si te tocaran un tema sexual inc√≥modo?", emoji: "üî•", category: "sexual" },
      { text: "Si fueras un superh√©roe, ¬øcu√°l ser√≠a tu poder?", emoji: "ü§™", category: "funny" },
      { text: "¬øCu√°l es el peor chiste que conoces?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras ser cualquier animal por un d√≠a, ¬øcu√°l ser√≠as?", emoji: "ü§™", category: "funny" },
      { text: "¬øQu√© har√≠as si pudieras hablar con los animales?", emoji: "ü§™", category: "funny" },
      { text: "¬øQu√© har√≠as si fueras un ni√±o otra vez por un d√≠a?", emoji: "ü§™", category: "funny" },
      { text: "¬øTe has re√≠do alguna vez en una situaci√≥n inapropiada?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras ser famoso por algo rid√≠culo, ¬øqu√© har√≠as?", emoji: "ü§™", category: "funny" },
      { text: "¬øCu√°l es tu imitaci√≥n de voz m√°s graciosa?", emoji: "ü§™", category: "funny" },
      { text: "Si fueras un personaje de dibujos animados, ¬øqui√©n ser√≠as?", emoji: "ü§™", category: "funny" },
      { text: "¬øQu√© opinas sobre el destino? ¬øCrees que todo pasa por una raz√≥n?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© har√≠as si supieras que te queda solo un d√≠a de vida?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øTe gustar√≠a saber cu√°ndo vas a morir?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© opinas sobre el concepto de libertad?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCu√°l es el mayor sacrificio que has hecho en tu vida?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCrees que hay vida despu√©s de la muerte?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© har√≠as si tuvieras el poder de cambiar el mundo?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© significa para ti la libertad?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© es lo que m√°s te gusta hacer con tu pareja?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCu√°l es tu recuerdo m√°s bonito de un amor?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øTienes alguna cita famosa sobre el amor que te guste?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øC√≥mo te gustar√≠a que fuera tu boda ideal?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCu√°l es el detalle m√°s bonito que has recibido de un ser querido?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCrees que el amor puede sanar heridas emocionales?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© tipo de abrazos te gustan m√°s?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© har√≠as si alguien te declarara su amor de una forma muy original?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© significa para ti el amor verdadero?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© opinas sobre las sorpresas rom√°nticas?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCu√°l es tu canci√≥n rom√°ntica favorita y por qu√©?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øPrefieres las muestras de cari√±o en p√∫blico o en privado? ¬øPor qu√©?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øC√≥mo fue la vez que te enamoraste de alguien que no esperabas?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© significa para ti una relaci√≥n saludable?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCu√°l ha sido el gesto m√°s rom√°ntico que has hecho por alguien?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© tipo de regalos sentimentales te gustan m√°s?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCu√°l es la cualidad m√°s atractiva que buscas en una pareja?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© har√≠as si te enamoras de alguien con quien no puedes estar?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© importancia le das a la lealtad en una relaci√≥n?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øC√≥mo te gustar√≠a explorar diferentes tipos de sexo?", emoji: "üî•", category: "sexual" },
      { text: "¬øC√≥mo te sentir√≠as si tu pareja te pidiera algo fuera de lo com√∫n en la intimidad?", emoji: "üî•", category: "sexual" },
      { text: "¬øHay alguna pr√°ctica que jam√°s har√≠as en la cama?", emoji: "üî•", category: "sexual" },
      { text: "¬øC√≥mo te sentir√≠as si tuvieses que experimentar sexo en lugares p√∫blicos?", emoji: "üî•", category: "sexual" },
      { text: "¬øPrefieres que la intimidad sea lenta o r√°pida? ¬øPor qu√©?", emoji: "üî•", category: "sexual" },
      { text: "¬øHas tenido alguna vez un sue√±o er√≥tico? ¬øC√≥mo fue?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© es lo que m√°s te excita en la intimidad?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© opinas sobre las pel√≠culas para adultos?", emoji: "üî•", category: "sexual" },
      { text: "¬øTe consideras una persona atrevida en la intimidad? ¬øPor qu√©?", emoji: "üî•", category: "sexual" },
      { text: "¬øCu√°l es tu fantas√≠a sexual m√°s atrevida?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© piensas de la sexualidad abierta?", emoji: "üî•", category: "sexual" },
      { text: "¬øC√≥mo te gustar√≠a que fuera una noche de pasi√≥n perfecta?", emoji: "üî•", category: "sexual" },
      { text: "¬øPrefieres el sexo suave o m√°s intenso? ¬øQu√© te atrae de cada uno?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© importancia le das a la atracci√≥n por personas del mismo sexo?", emoji: "üî•", category: "sexual" },
      { text: "¬øTienes alguna preferencia por alg√∫n tipo de ropa en la intimidad?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© har√≠as si un desconocido te hiciera una propuesta sexual?", emoji: "üî•", category: "sexual" },
      { text: "¬øC√≥mo describir√≠as una relaci√≥n sexual ideal para ti?", emoji: "üî•", category: "sexual" },
      { text: "¬øPrefieres tener sexo con emoci√≥n o relajado? ¬øPor qu√©?", emoji: "üî•", category: "sexual" },
      { text: "Si fueras una celebridad por un d√≠a, ¬øqu√© har√≠as?", emoji: "ü§™", category: "funny" },
      { text: "¬øCu√°l es la comida m√°s rara que te gusta comer?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras vivir en una pel√≠cula, ¬øcu√°l escoger√≠as y por qu√©?", emoji: "ü§™", category: "funny" },
      { text: "¬øQu√© superpoder elegir√≠as para hacerle bromas a la gente?", emoji: "ü§™", category: "funny" },
      { text: "¬øTe atrever√≠as a cantar en p√∫blico en un karaoke? ¬øPor qu√©?", emoji: "ü§™", category: "funny" },
      { text: "Si fueras un personaje de Disney, ¬øqui√©n ser√≠as y por qu√©?", emoji: "ü§™", category: "funny" },
      { text: "¬øTe has ca√≠do alguna vez de una forma muy graciosa? ¬øC√≥mo fue?", emoji: "ü§™", category: "funny" },
      { text: "¬øCu√°l es el peor apodo que te han puesto y c√≥mo lo tomaste?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras vivir en cualquier √©poca, ¬øcu√°l escoger√≠as y por qu√©?", emoji: "ü§™", category: "funny" },
      { text: "Si fueras un detective, ¬øqu√© tipo de crimen resolver√≠as?", emoji: "ü§™", category: "funny" },
      { text: "¬øTe gustar√≠a tener una mascota ex√≥tica? ¬øCu√°l?", emoji: "ü§™", category: "funny" },
      { text: "¬øTienes alguna man√≠a rara? ¬øCu√°l?", emoji: "ü§™", category: "funny" },
      { text: "Si fueras un inventor, ¬øqu√© inventar√≠as?", emoji: "ü§™", category: "funny" },
      { text: "Si fueras invisible por un d√≠a, ¬øa qu√© persona espiar√≠as y por qu√©?", emoji: "ü§™", category: "funny" },
      { text: "¬øQu√© har√≠as si te encuentras con tu ‚Äòyo‚Äô del futuro?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras tener cualquier habilidad in√∫til, ¬øcu√°l elegir√≠as?", emoji: "ü§™", category: "funny" },
      { text: "¬øTe atrever√≠as a comer algo extremadamente picante?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras tener un animal como compa√±ero de trabajo, ¬øcu√°l escoger√≠as?", emoji: "ü§™", category: "funny" },
      { text: "¬øTe gustar√≠a tener un doble para que haga las tareas aburridas?", emoji: "ü§™", category: "funny" },
      { text: "Si pudieras cambiar de lugar con alguien por un d√≠a, ¬øqui√©n ser√≠as y por qu√©?", emoji: "ü§™", category: "funny" },
      { text: "¬øQu√© significa para ti la felicidad?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© har√≠as si pudieras cambiar un evento hist√≥rico?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øTe gustar√≠a saber todos los secretos del universo?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© es lo m√°s valioso para ti en la vida?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© piensas sobre el sufrimiento humano?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© opinas sobre la religi√≥n?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCrees que el tiempo es relativo?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCu√°l es tu concepto de libertad?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© cambiar√≠as en la sociedad para mejorarla?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© opinas sobre el destino y la suerte?", emoji: "ü§Ø", category: "intense" },
      { text: "Si murieras ma√±ana, ¬øqu√© har√≠as hoy?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© es lo m√°s rid√≠culo que has hecho estando borraxe?", emoji: "ü§™", category: "funny" },
      { text: "Di algo que haga una persona que te genere confianza.", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "Di una cosa que coger√≠as y otra que descartar√≠as de les integrantes de la mesa.", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© es lo que nunca te gustar√≠a probar en la cama?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© objeto salvar√≠as de un incendio?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© es lo que la mayor√≠a de la gente suele pensar de ti?", emoji: "ü§Ø", category: "intense" },
      { text: "Si solo pudieras vivir en una estaci√≥n del a√±o, ¬øcu√°l ser√≠a?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øCu√°ndo fue la √∫ltima vez que lloraste delante de alguien? ¬øPor qu√©?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© es lo que mejor se te da en la cama?", emoji: "üî•", category: "sexual" },
      { text: "¬øCu√°l es la parte que consideras m√°s sexy de tu cuerpo?", emoji: "üî•", category: "sexual" },
      { text: "Si pudieras revivir un momento de tu vida, ¬øcu√°l ser√≠a?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© papel juegan los viajes en tu vida y cu√°l ha sido tu experiencia m√°s impactante?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© crees que es lo que m√°s te ha marcado en tu infancia?", emoji: "ü§Ø", category: "intense" },
      { text: "Si ma√±ana pudieras levantarte disfrutando de una habilidad sexual nueva, ¬øcu√°l ser√≠a?", emoji: "üî•", category: "sexual" },
      { text: "¬øCu√°l es tu mayor complejo f√≠sico y qu√© es lo que m√°s te gusta de ti?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "Si no pudieras hacer lo que est√°s haciendo ahora, ¬øc√≥mo te gustar√≠a ganarte la vida?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCu√°l es el mejor recuerdo de tu infancia?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "Di una cosa que creas tener en com√∫n sexualmente con les personas de la mesa.", emoji: "üî•", category: "sexual" },
      { text: "Si tuvieras que elegir ahora mismo un/a famoso/a para tener relaciones sexuales, ¬øqui√©n ser√≠a?", emoji: "üî•", category: "sexual" },
      { text: "¬øQui√©n te inspira m√°s?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øTe gustar√≠a ser famoso/a? ¬øDe qu√© forma?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© es lo que valoras m√°s de un amigo/a?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "Di una frase para tu l√°pida.", emoji: "ü§™", category: "funny" },
      { text: "¬øC√≥mo te gustar√≠a ser recordado/a?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© querr√≠as que se hiciera con tu cuerpo al morir?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øC√≥mo te sientes respecto a tu relaci√≥n con tu madre?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øA qu√© personaje hist√≥rico te gustar√≠a conocer?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCon qu√© tipo de personas jam√°s te llevar√≠as bien?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCu√°l consideras que ser√≠a la peor muerte de todas?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© cambiar√≠as de tu presente?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQu√© dos adjetivos te definen mejor?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øQu√© es lo que m√°s echas de menos de tu infancia?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øEres como quieres ser?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øEn qu√© situaci√≥n estar√≠as dispuesto/a a mentir?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øBuscar√≠as ayuda para corregir un problema sexual?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© valoras m√°s, la amistad o la pareja?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øTe consideras buena persona?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "Escoge un tatuaje tuyo o de alguien de la mesa y explica su significado.", emoji: "ü§Ø", category: "intense" },
      { text: "¬øPor qu√© aspecto de tu vida sexual sientes m√°s gratitud?", emoji: "üî•", category: "sexual" },
      { text: "¬øCu√°ndo fue la √∫ltima vez que te masturbaste?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© sueles pensar cuando alguien se te queda mirando?", emoji: "ü§™", category: "funny" },
      { text: "¬øQu√© tipos de v√≠deos hot ves m√°s?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© es lo primero que haces al despertar?", emoji: "ü§Ø", category: "intense" },
      { text: "Completa esta frase: Ojal√° tuviera a alguien con quien compartir...", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øHas grabado alguna vez un video √≠ntimo?", emoji: "üî•", category: "sexual" },
      { text: "¬øHar√≠as cibersexo?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© es lo que m√°s te gusta que te hagan en la cama?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© te parecer√≠a importante destacar en tu carta de presentaci√≥n?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øQui√©n crees que tiene una idea err√≥nea de c√≥mo eres? ¬øCu√°l es?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øHay algo que te parezca demasiado serio como para no hacer bromas al respecto?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øCu√°l es la parte m√°s sensible de tu cuerpo?", emoji: "üî•", category: "sexual" },
      { text: "Cuando algo no te apetece, ¬øsabes poner l√≠mites?", emoji: "‚ù§Ô∏è", category: "love" },
      { text: "¬øTe consideras dominante/a en la cama?", emoji: "üî•", category: "sexual" },
      { text: "¬øHas tenido relaciones sexuales con personas desconocidas?", emoji: "üî•", category: "sexual" },
      { text: "¬øQu√© es lo m√°s alocado que has hecho?", emoji: "ü§™", category: "funny" },
      { text: "¬øA qu√© le tienes un miedo irracional?", emoji: "ü§Ø", category: "intense" },
      { text: "¬øC√≥mo te sentir√≠as si pillaras a tu pareja d√°ndose autoplacer?", emoji: "üî•", category: "sexual" }
    ];

    /* =========================
       UTIL: mostrar/ocultar pantallas
       - manejamos aria-hidden para accesibilidad
    ========================== */
    function showScreen(screenEl){
      [splash, playerSetup, categorySetup, gameScreen].forEach(el=>{
        if(el === screenEl){ el.setAttribute('aria-hidden','false'); el.classList.add('animate-zoom-in') }
        else{ el.setAttribute('aria-hidden','true') }
      });
      // Enfocar el primer control util de la pantalla visible
      setTimeout(()=>{
        const focusable = screenEl.querySelector('button, [tabindex], input, a');
        if(focusable) focusable.focus({preventScroll:true});
      },280);
    }

    /* =========================
       GESTI√ìN DE JUGADORES
    ========================== */
    addPlayerBtn.addEventListener('click', ()=> {
      if(playerCount >= MAX_PLAYERS){
        alert(`¬°No puedes a√±adir m√°s de ${MAX_PLAYERS} jugadores!`);
        return;
      }
      playerCount++;
      const idx = playerCount;
      const input = document.createElement('input');
      input.type='text';
      input.className='input player-name';
      input.placeholder = `Nombre ${idx}`;
      input.setAttribute('aria-label', `Nombre jugador ${idx}`);
      playerInputsContainer.appendChild(input);

      // scroll ligero para ver el nuevo input en pantallas peque√±as
      input.scrollIntoView({behavior:'smooth', block:'center'});
      input.focus();
    });

    // permitir Enter en inputs para a√±adir jugador r√°pido (UX)
    playerInputsContainer.addEventListener('keydown', (e) => {
      if(e.key === 'Enter'){
        e.preventDefault();
        // si estamos en un input vac√≠o no a√±adimos jugador, enfocamos siguiente
        const inputs = Array.from(playerInputsContainer.querySelectorAll('.player-name'));
        const idx = inputs.indexOf(e.target);
        if(idx === inputs.length-1) addPlayerBtn.click();
        else inputs[idx+1].focus();
      }
    });

    // Start game: leer nombres
    startBtn.addEventListener('click', ()=> {
      players = [];
      document.querySelectorAll('.player-name').forEach( input => {
        const name = input.value.trim();
        if(name) players.push({ name, score:0 });
      });
      if(players.length === 0){
        alert('Introduce al menos un nombre para empezar.');
        return;
      }
      // avanzar a selecci√≥n de categor√≠as
      showScreen(categorySetup);
    });

    /* =========================
       CATEGOR√çAS
    ========================== */
    selectAllCheckbox.addEventListener('change', (e)=>{
      const checked = e.target.checked;
      document.querySelectorAll('.category-checkbox').forEach(ch => ch.checked = checked);
    });

    applyCategoriesBtn.addEventListener('click', ()=>{
      const selected = Array.from(document.querySelectorAll('.category-checkbox:checked')).map(c=>c.value);
      if(selected.length === 0){
        alert('¬°Por favor selecciona al menos una categor√≠a!');
        return;
      }
      // filtrar preguntas
      const filtered = questions.filter(q => selected.includes(q.category));
      if(filtered.length === 0) { alert('¬°No hay preguntas en las categor√≠as seleccionadas!'); return; }
      // guardamos las preguntas filtradas en ventana para acceso r√°pido
      window.filteredQuestions = filtered.slice(); // copia
      usedQuestions.clear();
      showScreen(gameScreen);
      renderScores();
    });

    /* =========================
       PREGUNTAS / USO
    ========================== */
    function pickRandomQuestion(){
      if(!window.filteredQuestions || window.filteredQuestions.length === 0) {
        // si por alg√∫n motivo no hay preguntas, recargar todas
        window.filteredQuestions = questions.slice();
      }
      const available = window.filteredQuestions.filter(q => !usedQuestions.has(q.text));
      if(available.length === 0){
        usedQuestions.clear();
        // volver a calcular
        return pickRandomQuestion();
      }
      const q = available[Math.floor(Math.random()*available.length)];
      usedQuestions.add(q.text);
      return q;
    }

    newQuestionBtn.addEventListener('click', ()=>{
      const q = pickRandomQuestion();
      document.getElementById('question').textContent = q.text;
      document.getElementById('emoji').textContent = q.emoji || '';
    });

    /* =========================
       PUNTUACIONES
    ========================== */
    function renderScores(){
      playerScoresContainer.innerHTML = '';
      players.forEach((player, index) => {
        const row = document.createElement('div');
        row.className = 'player-row';

        const nameEl = document.createElement('div');
        nameEl.className = 'player-name';
        nameEl.textContent = `${player.name}: ${player.score}`;

        // botones +/-
        const controls = document.createElement('div');
        controls.className = 'score-controls';
        controls.setAttribute('role','group');
        controls.setAttribute('aria-label', `Controles puntuaci√≥n ${player.name}`);

        const sub = document.createElement('button');
        sub.innerHTML = '‚ûñ';
        sub.title = `Restar 10 a ${player.name}`;
        sub.addEventListener('click', ()=> subtractScore(index));

        const add = document.createElement('button');
        add.innerHTML = '‚ûï';
        add.title = `Sumar 10 a ${player.name}`;
        add.addEventListener('click', ()=> addScore(index));

        controls.appendChild(sub);
        controls.appendChild(add);

        // progress bar
        const progressOuter = document.createElement('div');
        progressOuter.className = 'progress-outer';
        const progressInner = document.createElement('div');
        progressInner.className = 'progress-inner';
        const pct = Math.min(100, Math.round((player.score / MAX_SCORE) * 100));
        progressInner.style.width = pct + '%';
        progressInner.setAttribute('aria-hidden','true');

        progressOuter.appendChild(progressInner);

        row.appendChild(nameEl);
        row.appendChild(progressOuter);
        row.appendChild(controls);

        playerScoresContainer.appendChild(row);
      });
    }

    function addScore(idx){
      players[idx].score += 10;
      if(players[idx].score >= MAX_SCORE){
        alert(`${players[idx].name} ha obtenido la mayor puntuaci√≥n, pero todas hab√©is ganado üíú`);
        // recarga suave (si prefieres resetear sin recarga, se puede cambiar)
        setTimeout(()=> location.reload(), 2000);
        return;
      }
      renderScores();
    }

    function subtractScore(idx){
      if(players[idx].score > 0){
        players[idx].score = Math.max(0, players[idx].score - 10);
        renderScores();
      } else {
        alert('¬°Ojo! La puntuaci√≥n no puede ser menor a 0');
      }
    }

    /* =========================
       POPUP DE VERSI√ìN (localStorage)
       - Lee <meta name="app-version" content="...">
       - Si cambia respecto a localStorage (key 'seenVersion'), lo muestra
       - Al aceptar guarda el texto en localStorage para no mostrarlo otra vez
    ========================== */
    function handleVersionPopup(){
      const meta = document.querySelector('meta[name="app-version"]');
      const current = (meta && meta.getAttribute('content')) ? meta.getAttribute('content').trim() : '';
      if(!current) return;

      versionTextEl.textContent = current;
      versionAnnounce.textContent = current; // para lectores de pantalla

      const seen = localStorage.getItem('seenVersion') || '';

      if(seen !== current){
        // mostrar popup
        versionPopup.classList.add('show');
        versionPopup.setAttribute('aria-hidden','false');
        versionPopup.querySelector('button').focus();
      }
    }

    closeVersionBtn.addEventListener('click', ()=>{
      const meta = document.querySelector('meta[name="app-version"]');
      const current = (meta && meta.getAttribute('content')) ? meta.getAttribute('content').trim() : '';
      if(current) localStorage.setItem('seenVersion', current);
      versionPopup.classList.remove('show');
      versionPopup.setAttribute('aria-hidden','true');
    });

    /* =========================
       INICIALIZACI√ìN: mostrar splash -> playerSetup
    ========================== */
    document.addEventListener('DOMContentLoaded', ()=> {
      // Mostrar splash 2s (puedes ajustar)
      showScreen(splash);
      handleVersionPopup();

      setTimeout(()=> {
        // ocultar splash y mostrar pantalla players
        showScreen(playerSetup);
      }, 1800);

      // Evitar doble-clic que haga zoom en m√≥viles (mantenemos tu comportamiento)
      document.addEventListener('dblclick', (ev)=> ev.preventDefault(), { passive:false });
    });

    // Exportar para debugging (opcional)
    window.__meetApp = {
      showScreen, pickRandomQuestion, renderScores, addScore, subtractScore, players
    };

  })();
  </script>
</body>
</html>
