<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Meet - Experience</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Caveat&family=Comfortaa:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root { --bg-dark: #000000; }
        html, body { height: 100%; width: 100%; margin: 0; padding: 0; background-color: var(--bg-dark); overflow: hidden; position: fixed; }
        body { font-family: 'Comfortaa', sans-serif; -webkit-tap-highlight-color: transparent; display: flex; flex-direction: column; }
        .font-caveat { font-family: 'Caveat', cursive; }
        .question-box { background: linear-gradient(145deg, #0d1e75, #9a18a4); min-height: 42vh; display: flex; flex-direction: column; justify-content: center; transition: all 0.3s ease; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .animate-shake { animation: shake 0.2s ease-in-out 2; }
        @keyframes zoomIn { 0% { opacity: 0; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
        .animate-zoom-in { animation: zoomIn 0.3s ease-out forwards; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .hidden { display: none !important; }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
        .safe-pt { padding-top: env(safe-area-inset-top); }
        input::placeholder { color: rgba(255,255,255,0.4); }
        .mood-card { transition: all 0.2s ease; border: 1px solid rgba(255,255,255,0.1); }
        .mood-card.selected { border-color: #fff; background: rgba(255,255,255,0.1); transform: scale(1.05); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="text-white">

    <div id="splash-screen" class="fixed inset-0 flex items-center justify-center bg-white z-50">
        <div class="flex flex-col items-center text-center px-6">
             <div class="w-24 h-24 bg-black rounded-full flex items-center justify-center text-white font-bold animate-pulse text-2xl">MEET</div>
             <p class="text-black mt-8 font-caveat text-3xl">Cargando cat√°logo completo...</p>
        </div>
    </div>

    <div id="win-modal" class="hidden fixed inset-0 flex items-center justify-center z-[100] bg-black/90 p-6 animate-zoom-in">
        <div class="text-center">
            <div class="text-8xl mb-6 animate-float">üèÜ</div>
            <h2 class="text-4xl font-caveat mb-2">¬°Victoria!</h2>
            <p id="winner-name" class="text-xl font-bold text-purple-400 mb-6 tracking-widest uppercase">ALGUIEN</p>
            <button onclick="closeWinModal()" class="bg-white text-black font-bold py-4 px-12 rounded-full text-[10px] tracking-widest uppercase active:scale-95 transition-all">Seguir jugando</button>
        </div>
    </div>

    <div id="lobby-setup" class="hidden fixed inset-0 flex flex-col items-center justify-center p-6 z-40 animate-zoom-in safe-pt safe-pb">
        <h1 class="text-6xl mb-4 font-caveat text-center text-white">MEET</h1>
        <p class="mb-10 opacity-40 text-[10px] tracking-[0.4em] uppercase text-center">Conexi√≥n Real</p>
        
        <div class="w-full max-w-xs space-y-4">
            <input id="user-nickname" type="text" class="w-full bg-white/10 text-white px-6 py-4 rounded-2xl outline-none border border-white/20 text-center" placeholder="Tu nombre o apodo">
            
            <p class="text-[9px] uppercase tracking-widest text-center opacity-40 mt-4">Elige el ambiente</p>
            <div id="mood-selector" class="grid grid-cols-4 gap-2 py-2">
                <button onclick="selectMood('chill', this)" class="mood-card selected p-2 rounded-xl flex flex-col items-center">
                    <span class="text-lg">‚ù§Ô∏è</span>
                    <span class="text-[7px] mt-1 uppercase font-bold opacity-60">Chill</span>
                </button>
                <button onclick="selectMood('hot', this)" class="mood-card p-2 rounded-xl flex flex-col items-center">
                    <span class="text-lg">üî•</span>
                    <span class="text-[7px] mt-1 uppercase font-bold opacity-60">Hot</span>
                </button>
                <button onclick="selectMood('psycho', this)" class="mood-card p-2 rounded-xl flex flex-col items-center">
                    <span class="text-lg">üß†</span>
                    <span class="text-[7px] mt-1 uppercase font-bold opacity-60">Psycho</span>
                </button>
                <button onclick="selectMood('mix', this)" class="mood-card p-2 rounded-xl flex flex-col items-center">
                    <span class="text-lg">üåÄ</span>
                    <span class="text-[7px] mt-1 uppercase font-bold opacity-60">Mix</span>
                </button>
            </div>

            <div class="pt-2 space-y-3">
                <button id="btn-create-room" class="w-full bg-white text-black py-4 rounded-2xl font-bold active:scale-95 transition-all shadow-lg">CREAR SALA NUEVA</button>
                <div class="flex items-center py-2 opacity-20"><div class="flex-grow border-t"></div><span class="mx-4 text-[10px]">O</span><div class="flex-grow border-t"></div></div>
                <div class="flex flex-col space-y-2">
                    <input id="room-id-input" type="text" maxlength="4" class="w-full bg-white/5 text-white px-4 py-4 rounded-2xl border border-white/10 uppercase outline-none text-center font-bold tracking-[0.4em]" placeholder="C√ìDIGO">
                    <button id="btn-join-room" class="w-full bg-indigo-600/50 py-4 rounded-2xl font-bold active:scale-95 transition-all border border-indigo-400/20">UNIRSE A SALA</button>
                </div>
            </div>
        </div>
    </div>

    <div id="game-screen" class="hidden fixed inset-0 flex flex-col justify-between items-center py-6 px-4 z-30 animate-zoom-in safe-pt safe-pb bg-black">
        <div class="w-full flex justify-between items-center px-4">
            <button id="btn-exit" class="text-white/20 uppercase text-[10px] tracking-widest font-bold">Salir</button>
            <div id="display-room-id" class="text-[10px] font-bold bg-white/5 px-4 py-2 rounded-full border border-white/10 text-purple-400 tracking-[0.2em]">----</div>
        </div>

        <div id="turn-indicator" class="text-[10px] uppercase tracking-[0.3em] font-bold text-white/40 mb-2 bg-white/5 px-6 py-2 rounded-full border border-white/5">Esperando...</div>

        <div id="q-container" class="question-box w-full max-w-sm p-8 rounded-[3rem] shadow-2xl text-center relative mx-4 border border-white/10">
            <div id="emoji" class="text-6xl mb-6 drop-shadow-lg">‚ú®</div>
            <div class="flex-1 flex items-center justify-center min-h-[140px]">
                <p id="question" class="text-2xl md:text-3xl font-caveat leading-tight px-2 text-white">...</p>
            </div>
            
            <div id="host-controls" class="mt-8 hidden flex flex-col items-center space-y-4">
                <div class="flex space-x-2 w-full justify-center">
                    <button id="btn-skip" class="bg-white/10 text-white/60 font-bold py-4 px-6 rounded-full active:scale-90 transition-all text-[9px] tracking-[0.2em] border border-white/10">SALTAR</button>
                    <button id="new-question" class="bg-white text-black font-bold py-4 px-10 rounded-full shadow-2xl active:scale-90 transition-all text-[9px] tracking-[0.2em]">SIGUIENTE</button>
                </div>
                <button id="btn-reset" class="text-[8px] uppercase tracking-[0.4em] opacity-30 mt-2 border border-white/10 px-4 py-2 rounded-full">Reset Marcadores</button>
            </div>
        </div>

        <div id="player-scores" class="w-full max-w-sm space-y-3 overflow-y-auto max-h-[25vh] mt-8 px-2 scrollbar-hide"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'meet-game-final';

        let currentRoomId = null;
        let currentUser = null;
        let isHost = false;
        let selectedMood = 'chill';
        let unsubscribeRoom = null;
        let hasWinnerShown = false;

        const DATABASE = {
            chill: [
                { text: "¬øQu√© significa el amor para ti?", emoji: "‚ù§Ô∏è" },
                { text: "¬øEn qu√© crees que se basa el amor a primera vista?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© fue lo que m√°s te molest√≥ de tu primer amor?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© es lo m√°s fuerte que has hecho por amor?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© significa para ti ser una persona rom√°ntica?", emoji: "‚ù§Ô∏è" },
                { text: "¬øC√≥mo ser√≠a tu cita perfecta?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© piensas sobre el concepto de amor eterno?", emoji: "‚ù§Ô∏è" },
                { text: "¬øTe gustar√≠a tener una relaci√≥n a larga distancia? ¬øPor qu√©?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCu√°l es tu mayor temor en una relaci√≥n?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© valoras m√°s en una pareja?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© es lo que m√°s te gusta hacer con tu pareja?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCu√°l es tu recuerdo m√°s bonito de un amor?", emoji: "‚ù§Ô∏è" },
                { text: "¬øTienes alguna cita famosa sobre el amor que te guste?", emoji: "‚ù§Ô∏è" },
                { text: "¬øC√≥mo te gustar√≠a que fuera tu boda ideal?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCu√°l es el detalle m√°s bonito que has recibido de un ser querido?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCrees que el amor puede sanar heridas emocionales?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© tipo de abrazos te gustan m√°s?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© har√≠as si alguien te declarara su amor de una forma muy original?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© significa para ti el amor verdadero?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© opinas sobre las sorpresas rom√°nticas?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCu√°l es tu canci√≥n rom√°ntica favorita y por qu√©?", emoji: "‚ù§Ô∏è" },
                { text: "¬øPrefieres las muestras de cari√±o en p√∫blico o en privado? ¬øPor qu√©?", emoji: "‚ù§Ô∏è" },
                { text: "¬øC√≥mo fue la vez que te enamoraste de alguien que no esperabas?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© significa para ti una relaci√≥n saludable?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCu√°l ha sido el gesto m√°s rom√°ntico que has hecho por alguien?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© tipo de regalos sentimentales te gustan m√°s?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCu√°l es la cualidad m√°s atractiva que buscas en una pareja?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© har√≠as si te enamoras de alguien con quien no puedes estar?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© importancia le das a la lealtad en una relaci√≥n?", emoji: "‚ù§Ô∏è" },
                { text: "Di algo que haga una persona que te genere confianza.", emoji: "‚ù§Ô∏è" },
                { text: "Si solo pudieras vivir en una estaci√≥n del a√±o, ¬øcu√°l ser√≠a?", emoji: "‚ù§Ô∏è" },
                { text: "Si pudieras revivir un momento de tu vida, ¬øcu√°l ser√≠a?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCu√°l es tu mayor complejo f√≠sico y qu√© es lo que m√°s te gusta de ti?", emoji: "‚ù§Ô∏è" },
                { text: "¬øCu√°l es el mejor recuerdo de tu infancia?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQui√©n te inspira m√°s?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© es lo que valoras m√°s de un amigo/a?", emoji: "‚ù§Ô∏è" },
                { text: "¬øC√≥mo te gustar√≠a ser recordado/a?", emoji: "‚ù§Ô∏è" },
                { text: "¬øC√≥mo te sientes respecto a tu relaci√≥n con tu madre?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© dos adjetivos te definen mejor?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© es lo que m√°s echas de menos de tu infancia?", emoji: "‚ù§Ô∏è" },
                { text: "¬øQu√© valoras m√°s, la amistad o la pareja?", emoji: "‚ù§Ô∏è" },
                { text: "¬øTe consideras buena persona?", emoji: "‚ù§Ô∏è" },
                { text: "Completa esta frase: Ojal√° tuviera a alguien con quien compartir...", emoji: "‚ù§Ô∏è" },
                { text: "Cuando algo no te apetece, ¬øsabes poner l√≠mites?", emoji: "‚ù§Ô∏è" }
            ],
            hot: [
                { text: "Si fueras invisible por un d√≠a, ¬øqu√© har√≠as?", emoji: "üî•" },
                { text: "¬øC√≥mo te consideras en la cama?", emoji: "üî•" },
                { text: "¬øQu√© parte de tu cuerpo consideras m√°s atractiva?", emoji: "üî•" },
                { text: "¬øCu√°l es tu fantas√≠a sexual m√°s secreta?", emoji: "üî•" },
                { text: "¬øC√≥mo describir√≠as la qu√≠mica perfecta entre dos personas?", emoji: "üî•" },
                { text: "¬øQu√© opinas sobre el sexo sin compromiso?", emoji: "üî•" },
                { text: "¬øCu√°l es tu juguete sexual favorito?", emoji: "üî•" },
                { text: "¬øTe gustar√≠a probar cosas nuevas en la intimidad? ¬øQu√© tipo?", emoji: "üî•" },
                { text: "¬øTe consideras un buen amante? ¬øPor qu√©?", emoji: "üî•" },
                { text: "¬øQu√© har√≠as si te tocaran un tema sexual inc√≥modo?", emoji: "üî•" },
                { text: "¬øC√≥mo te gustar√≠a explorar diferentes tipos de sexo?", emoji: "üî•" },
                { text: "¬øC√≥mo te sentir√≠as si tu pareja te pidiera algo fuera de lo com√∫n en la intimidad?", emoji: "üî•" },
                { text: "¬øHay alguna pr√°ctica que jam√°s har√≠as en la cama?", emoji: "üî•" },
                { text: "¬øC√≥mo te sentir√≠as si tuvieses que experimentar sexo en lugares p√∫blicos?", emoji: "üî•" },
                { text: "¬øPrefieres que la intimidad sea lenta o r√°pida? ¬øPor qu√©?", emoji: "üî•" },
                { text: "¬øHas tenido alguna vez un sue√±o er√≥tico? ¬øC√≥mo fue?", emoji: "üî•" },
                { text: "¬øQu√© es lo que m√°s te excita en la intimidad?", emoji: "üî•" },
                { text: "¬øQu√© opinas sobre las pel√≠culas para adultos?", emoji: "üî•" },
                { text: "¬øTe consideras una persona atrevida en la intimidad? ¬øPor qu√©?", emoji: "üî•" },
                { text: "¬øCu√°l es tu fantas√≠a sexual m√°s atrevida?", emoji: "üî•" },
                { text: "¬øQu√© piensas de la sexualidad abierta?", emoji: "üî•" },
                { text: "¬øC√≥mo te gustar√≠a que fuera una noche de pasi√≥n perfecta?", emoji: "üî•" },
                { text: "¬øPrefieres el sexo suave o m√°s intenso?", emoji: "üî•" },
                { text: "¬øQu√© importancia le das a la atracci√≥n por personas del mismo sexo?", emoji: "üî•" },
                { text: "¬øTienes alguna preferencia por alg√∫n tipo de ropa en la intimidad?", emoji: "üî•" },
                { text: "¬øQu√© har√≠as si un desconocido te hiciera una propuesta sexual?", emoji: "üî•" },
                { text: "¬øC√≥mo describir√≠as una relaci√≥n sexual ideal para ti?", emoji: "üî•" },
                { text: "¬øPrefieres tener sexo con emoci√≥n o relajado? ¬øPor qu√©?", emoji: "üî•" },
                { text: "¬øQu√© es lo que nunca te gustar√≠a probar en la cama?", emoji: "üî•" },
                { text: "¬øQu√© es lo que mejor se te da en la cama?", emoji: "üî•" },
                { text: "¬øCu√°l es la parte que consideras m√°s sexy de tu cuerpo?", emoji: "üî•" },
                { text: "Si ma√±ana pudieras levantarte disfrutando de una habilidad sexual nueva, ¬øcu√°l ser√≠a?", emoji: "üî•" },
                { text: "Di una cosa que creas tener en com√∫n sexualmente con les personas de la mesa.", emoji: "üî•" },
                { text: "Si tuvieras que elegir ahora mismo un/a famoso/a para tener relaciones sexuales, ¬øqui√©n ser√≠a?", emoji: "üî•" },
                { text: "¬øBuscar√≠as ayuda para corregir un problema sexual?", emoji: "üî•" },
                { text: "¬øPor qu√© aspecto de tu vida sexual sientes m√°s gratitud?", emoji: "üî•" },
                { text: "¬øCu√°ndo fue la √∫ltima vez que te masturbaste?", emoji: "üî•" },
                { text: "¬øQu√© tipos de v√≠deos hot ves m√°s?", emoji: "üî•" },
                { text: "¬øHas grabado alguna vez un video √≠ntimo?", emoji: "üî•" },
                { text: "¬øHar√≠as cibersexo?", emoji: "üî•" },
                { text: "¬øQu√© es lo que m√°s te gusta que te hagan en la cama?", emoji: "üî•" },
                { text: "¬øCu√°l es la parte m√°s sensible de tu cuerpo?", emoji: "üî•" },
                { text: "¬øTe consideras dominante/a en la cama?", emoji: "üî•" },
                { text: "¬øHas tenido relaciones sexuales con personas desconocidas?", emoji: "üî•" },
                { text: "¬øC√≥mo te sentir√≠as si pillaras a tu pareja d√°ndose autoplacer?", emoji: "üî•" }
            ],
            psycho: [
                { text: "Si fueras rico/a, ¬øqu√© har√≠as con tu fortuna?", emoji: "üß†" },
                { text: "Si pudieras tener cualquier superpoder, ¬øcu√°l escoger√≠as?", emoji: "üß†" },
                { text: "Si pudieras teletransportarte, ¬øa d√≥nde ir√≠as?", emoji: "üß†" },
                { text: "¬øCu√°l es tu mayor miedo y por qu√©?", emoji: "üß†" },
                { text: "¬øC√≥mo te gustar√≠a morir?", emoji: "üß†" },
                { text: "¬øCu√°l consideras que es el sentido de la vida?", emoji: "üß†" },
                { text: "Si fueras un animal por un d√≠a, ¬øcu√°l ser√≠as?", emoji: "üß†" },
                { text: "¬øQu√© har√≠as si pudieras hablar con los animales?", emoji: "üß†" },
                { text: "¬øQu√© har√≠as si fueras un ni√±o otra vez por un d√≠a?", emoji: "üß†" },
                { text: "¬øTe has re√≠do alguna vez en una situaci√≥n inapropiada?", emoji: "üß†" },
                { text: "Si pudieras ser famoso por algo rid√≠culo, ¬øqu√© har√≠as?", emoji: "üß†" },
                { text: "¬øQu√© opinas sobre el destino? ¬øCrees que todo pasa por una raz√≥n?", emoji: "üß†" },
                { text: "¬øQu√© har√≠as si supieras que te queda solo un d√≠a de vida?", emoji: "üß†" },
                { text: "¬øTe gustar√≠a saber cu√°ndo vas a morir?", emoji: "üß†" },
                { text: "¬øQu√© opinas sobre el concepto de libertad?", emoji: "üß†" },
                { text: "¬øCu√°l es el mayor sacrificio que has hecho en tu vida?", emoji: "üß†" },
                { text: "¬øCrees que hay vida despu√©s de la muerte?", emoji: "üß†" },
                { text: "¬øQu√© har√≠as si tuvieras el poder de cambiar el mundo?", emoji: "üß†" },
                { text: "¬øQu√© significa para ti la libertad?", emoji: "üß†" },
                { text: "Si fueras una celebridad por un d√≠a, ¬øqu√© har√≠as?", emoji: "üß†" },
                { text: "¬øCu√°l es la comida m√°s rara que te gusta comer?", emoji: "üß†" },
                { text: "Si pudieras vivir en una pel√≠cula, ¬øcu√°l escoger√≠as?", emoji: "üß†" },
                { text: "¬øTe atrever√≠as a cantar en p√∫blico en un karaoke?", emoji: "üß†" },
                { text: "¬øCu√°l es el peor apodo que te han puesto?", emoji: "üß†" },
                { text: "Si fueras un inventor, ¬øqu√© inventar√≠as?", emoji: "üß†" },
                { text: "¬øQu√© har√≠as si te encuentras con tu ‚Äòyo‚Äô del futuro?", emoji: "üß†" },
                { text: "Si pudieras tener cualquier habilidad in√∫til, ¬øcu√°l elegir√≠as?", emoji: "üß†" },
                { text: "¬øQu√© significa para ti la felicidad?", emoji: "üß†" },
                { text: "¬øQu√© har√≠as si pudieras cambiar un evento hist√≥rico?", emoji: "üß†" },
                { text: "¬øTe gustar√≠a saber todos los secretos del universo?", emoji: "üß†" },
                { text: "¬øQu√© es lo m√°s valioso para ti en la vida?", emoji: "üß†" },
                { text: "¬øQu√© piensas sobre el sufrimiento humano?", emoji: "üß†" },
                { text: "¬øQu√© opinas sobre la religi√≥n?", emoji: "üß†" },
                { text: "¬øQu√© cambiar√≠as en la sociedad para mejorarla?", emoji: "üß†" },
                { text: "¬øQu√© opinas sobre el destino y la suerte?", emoji: "üß†" },
                { text: "Si murieras ma√±ana, ¬øqu√© har√≠as hoy?", emoji: "üß†" },
                { text: "¬øQu√© es lo m√°s rid√≠culo que has hecho estando borraxe?", emoji: "üß†" },
                { text: "Di una cosa que coger√≠as y otra que descartar√≠as de les integrantes de la mesa.", emoji: "üß†" },
                { text: "¬øQu√© objeto salvar√≠as de un incendio?", emoji: "üß†" },
                { text: "¬øQu√© es lo que la mayor√≠a de la gente suele pensar de ti?", emoji: "üß†" },
                { text: "¬øCu√°ndo fue la √∫ltima vez que lloraste delante de alguien?", emoji: "üß†" },
                { text: "¬øQu√© papel juegan los viajes en tu vida?", emoji: "üß†" },
                { text: "¬øQu√© crees que es lo que m√°s te ha marcado en tu infancia?", emoji: "üß†" },
                { text: "Si no pudieras hacer lo que est√°s haciendo ahora, ¬øc√≥mo te gustar√≠a ganarte la vida?", emoji: "üß†" },
                { text: "¬øTe gustar√≠a ser famoso/a? ¬øDe qu√© forma?", emoji: "üß†" },
                { text: "Di una frase para tu l√°pida.", emoji: "üß†" },
                { text: "¬øQu√© querr√≠as que se hiciera con tu cuerpo al morir?", emoji: "üß†" },
                { text: "¬øA qu√© personaje hist√≥rico te gustar√≠a conocer?", emoji: "üß†" },
                { text: "¬øCon qu√© tipo de personas jam√°s te llevar√≠as bien?", emoji: "üß†" },
                { text: "¬øCu√°l consideras que ser√≠a la peor muerte de todas?", emoji: "üß†" },
                { text: "¬øQu√© cambiar√≠as de tu presente?", emoji: "üß†" },
                { text: "¬øEres como quieres ser?", emoji: "üß†" },
                { text: "¬øEn qu√© situaci√≥n estar√≠as dispuesto/a a mentir?", emoji: "üß†" },
                { text: "Escoge un tatuaje tuyo o de alguien de la mesa y explica su significado.", emoji: "üß†" },
                { text: "¬øQu√© sueles pensar cuando alguien se te queda mirando?", emoji: "üß†" },
                { text: "¬øQu√© es lo primero que haces al despertar?", emoji: "üß†" },
                { text: "¬øQu√© te parecer√≠a importante destacar en tu carta de presentaci√≥n?", emoji: "üß†" },
                { text: "¬øQui√©n crees que tiene una idea err√≥nea de c√≥mo eres?", emoji: "üß†" },
                { text: "¬øHay algo que te parezca demasiado serio como para no hacer bromas?", emoji: "üß†" },
                { text: "¬øQu√© es lo m√°s alocado que has hecho?", emoji: "üß†" },
                { text: "¬øA qu√© le tienes un miedo irracional?", emoji: "üß†" }
            ]
        };

        window.selectMood = (mood, el) => {
            selectedMood = mood;
            document.querySelectorAll('.mood-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
        };

        window.closeWinModal = () => {
            document.getElementById('win-modal').classList.add('hidden');
        };

        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('splash-screen').classList.add('hidden');
                document.getElementById('lobby-setup').classList.remove('hidden');
            } else {
                initAuth();
            }
        });

        document.getElementById('btn-create-room').onclick = async () => {
            const name = document.getElementById('user-nickname').value.trim();
            if (!name) return;
            isHost = true;
            currentRoomId = Math.random().toString(36).substring(2, 6).toUpperCase();
            
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', currentRoomId);
            await setDoc(roomRef, {
                host: currentUser.uid,
                mood: selectedMood,
                currentQuestion: { text: `Listo en modo ${selectedMood.toUpperCase()}`, emoji: "‚ú®" },
                players: [{ uid: currentUser.uid, name, score: 0 }],
                active: true,
                winner: null,
                turnIndex: 0
            });
            startRoomListener();
        };

        document.getElementById('btn-join-room').onclick = async () => {
            const name = document.getElementById('user-nickname').value.trim();
            const roomId = document.getElementById('room-id-input').value.toUpperCase().trim();
            if (!name || !roomId) return;

            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', roomId);
            const snap = await getDoc(roomRef);
            if (snap.exists() && snap.data().active) {
                currentRoomId = roomId;
                isHost = snap.data().host === currentUser.uid;
                const players = snap.data().players;
                if (!players.find(p => p.uid === currentUser.uid)) {
                    await updateDoc(roomRef, { players: arrayUnion({ uid: currentUser.uid, name, score: 0 }) });
                }
                startRoomListener();
            }
        };

        function startRoomListener() {
            document.getElementById('lobby-setup').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('display-room-id').innerText = currentRoomId;
            
            if (isHost) document.getElementById('host-controls').classList.remove('hidden');

            if (unsubscribeRoom) unsubscribeRoom();
            unsubscribeRoom = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', currentRoomId), (docSnap) => {
                if (!docSnap.exists() || !docSnap.data().active) return;
                const data = docSnap.data();
                
                const playersCount = data.players.length;
                const activePlayer = data.players[data.turnIndex % playersCount] || data.players[0];
                const turnText = activePlayer.uid === currentUser.uid ? "TU TURNO" : `TURNO DE: ${activePlayer.name}`;
                document.getElementById('turn-indicator').innerText = turnText;
                document.getElementById('turn-indicator').style.color = activePlayer.uid === currentUser.uid ? "#a855f7" : "rgba(255,255,255,0.4)";

                if (data.winner && !hasWinnerShown) {
                    document.getElementById('winner-name').innerText = data.winner;
                    document.getElementById('win-modal').classList.remove('hidden');
                    hasWinnerShown = true;
                } else if (!data.winner) {
                    hasWinnerShown = false;
                }

                const qText = document.getElementById('question');
                if (qText.innerText !== data.currentQuestion.text) {
                    document.getElementById('q-container').classList.add('animate-shake');
                    setTimeout(() => document.getElementById('q-container').classList.remove('animate-shake'), 400);
                    qText.innerText = data.currentQuestion.text;
                    document.getElementById('emoji').innerText = data.currentQuestion.emoji;
                }
                updateScoresUI(data.players);
            });
        }

        async function getNewQuestion(mood) {
            let pool = [];
            if (mood === 'mix') {
                pool = [...DATABASE.chill, ...DATABASE.hot, ...DATABASE.psycho];
            } else {
                pool = DATABASE[mood];
            }
            return pool[Math.floor(Math.random() * pool.length)];
        }

        document.getElementById('new-question').onclick = async () => {
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', currentRoomId);
            const snap = await getDoc(roomRef);
            const data = snap.data();
            const nextQ = await getNewQuestion(data.mood);
            await updateDoc(roomRef, { 
                currentQuestion: nextQ,
                turnIndex: data.turnIndex + 1
            });
        };

        document.getElementById('btn-skip').onclick = async () => {
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', currentRoomId);
            const snap = await getDoc(roomRef);
            const nextQ = await getNewQuestion(snap.data().mood);
            await updateDoc(roomRef, { currentQuestion: nextQ });
        };

        document.getElementById('btn-reset').onclick = async () => {
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', currentRoomId);
            const snap = await getDoc(roomRef);
            const players = snap.data().players.map(p => ({ ...p, score: 0 }));
            await updateDoc(roomRef, { players, winner: null, turnIndex: 0 });
        };

        function updateScoresUI(players) {
            document.getElementById('player-scores').innerHTML = players.map((p) => `
                <div class="bg-white/5 p-4 rounded-2xl border ${p.uid === currentUser.uid ? 'border-purple-500/50' : 'border-white/5'}">
                    <div class="flex justify-between items-center mb-2 text-[9px] font-bold uppercase tracking-widest">
                        <span>${p.name}</span>
                        <div class="flex items-center space-x-4">
                            ${p.uid === currentUser.uid ? `
                                <button onclick="window.changeScore(-10)" class="w-8 h-8 bg-white/10 rounded-xl flex items-center justify-center">Ôºç</button>
                                <span class="text-lg w-6 text-center">${p.score}</span>
                                <button onclick="window.changeScore(10)" class="w-8 h-8 bg-white/10 rounded-xl flex items-center justify-center">Ôºã</button>
                            ` : `<span class="text-lg">${p.score}</span>`}
                        </div>
                    </div>
                    <div class="w-full bg-black h-1 rounded-full overflow-hidden">
                        <div class="bg-purple-500 h-full transition-all duration-700 ${p.score >= 100 ? 'bg-yellow-400' : ''}" style="width:${p.score}%"></div>
                    </div>
                </div>
            `).join('');
        }

        window.changeScore = async (delta) => {
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', currentRoomId);
            const snap = await getDoc(roomRef);
            let winnerName = snap.data().winner;
            const players = snap.data().players.map(p => {
                if (p.uid === currentUser.uid) {
                    p.score = Math.max(0, Math.min(100, p.score + delta));
                    if (p.score === 100) winnerName = p.name;
                }
                return p;
            });
            await updateDoc(roomRef, { players, winner: winnerName });
        };

        document.getElementById('btn-exit').onclick = () => window.location.reload();
    </script>
</body>
</html>
