<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meet</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Mi Juego" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="apple-touch-icon" href="favicon2.png" />
  <link rel="icon" href="favicon.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Caveat&family=Comfortaa:wght@300;400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com" defer></script>

  <style>
    body {
      font-family: 'Comfortaa', sans-serif;
      background-color: #000000;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
    }
    h1 {
      font-family: 'Caveat', cursive;
    }
    .question-box {
      background: linear-gradient(145deg, #0d1e75, #9a18a4);
      height: 16rem;
      border-radius: 0.75rem;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(154, 24, 164, 0.7);
      color: white;
    }
    /* Animación más sutil */
    @keyframes zoomIn {
      from {
        opacity: 0.3;
        transform: scale(0.97);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    .animate-zoom-in {
      animation: zoomIn 0.5s ease-in-out;
    }
  </style>
</head>
<body class="relative text-white">

  <!-- Splash Screen -->
  <section id="splash-screen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
    <img src="logo.png" alt="Logotipo" class="w-2/3 animate-zoom-in" />
  </section>

  <!-- Player Setup -->
  <section id="player-setup" class="hidden fixed inset-0 bg-black bg-opacity-90 flex flex-col justify-center items-center p-10 z-40 animate-zoom-in">
    <h1 class="text-5xl font-extrabold text-center mb-6">¿Quiénes vais a<br>dejaros llevar?</h1>
    <form id="players-form" class="flex flex-col items-center space-y-3 w-full max-w-md">
      <input type="text" name="player" class="player-name rounded px-4 py-2 w-full text-black" placeholder="Nombre 1" required autocomplete="off" />
      <input type="text" name="player" class="player-name rounded px-4 py-2 w-full text-black" placeholder="Nombre 2" required autocomplete="off" />
      <button type="button" id="add-player" class="w-12 h-12 rounded-full bg-gradient-to-r from-[#0d1e75] to-[#9a18a4] text-white text-2xl font-bold hover:brightness-110 transition" aria-label="Añadir jugador">+</button>
    </form>
    <a href="instrucciones.html" target="_blank" rel="noopener noreferrer" class="mt-4 underline text-sm hover:text-purple-400">Instrucciones del juego</a>
    <button id="start-game" class="mt-6 bg-gradient-to-r from-[#0d1e75] to-[#9a18a4] py-3 px-8 rounded text-white font-semibold hover:brightness-110 transition">Empezar</button>
  </section>

  <!-- Category Setup -->
  <section id="category-setup" class="hidden fixed inset-0 bg-black bg-opacity-95 flex flex-col justify-center items-center p-10 z-30 animate-zoom-in">
    <h1 class="text-5xl font-extrabold text-center mb-6">¿En qué mood<br>estáis hoy?</h1>
    <form id="categories-form" class="space-y-5 max-w-sm w-full text-lg">
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" class="category-checkbox" name="category" value="love" />
        <span>Romántico ❤️</span>
      </label>
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" class="category-checkbox" name="category" value="sexual" />
        <span>Sexual 🔥</span>
      </label>
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" class="category-checkbox" name="category" value="funny" />
        <span>Divertido 🤪</span>
      </label>
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" class="category-checkbox" name="category" value="intense" />
        <span>Intenso 🤯</span>
      </label>
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" id="select-all" name="select-all" value="all" />
        <span>¡Vamos a por todas! 🎉</span>
      </label>
      <button type="submit" class="w-full bg-gradient-to-r from-[#0d1e75] to-[#9a18a4] py-3 rounded text-white font-semibold hover:brightness-110 transition mt-4">Continuar</button>
    </form>
  </section>

  <!-- Game Screen -->
  <main id="game-screen" class="hidden fixed inset-0 bg-black bg-opacity-95 flex flex-col justify-center items-center p-10 z-30 animate-zoom-in max-w-xl mx-auto w-full">
    <img src="logoblanco.png" alt="Logotipo" class="w-32 mb-6" />
    <section class="question-box w-full max-w-lg rounded-xl shadow-lg text-center">
      <div id="emoji" class="text-5xl mb-4 select-none"></div>
      <p id="question" class="text-2xl mb-6 font-caveat leading-relaxed select-text">¡Clica en «Déjate llevar» para comenzar la experiencia!</p>
      <button id="new-question" class="bg-purple-600 py-2 px-6 rounded text-white font-semibold hover:bg-purple-700 transition">Déjate llevar</button>
    </section>
    <section id="player-scores" class="mt-8 w-full max-w-md space-y-6" aria-live="polite"></section>
  </main>

  <footer class="fixed bottom-8 w-full text-center text-gray-400 text-sm italic select-none">
    &copy; 2025 Propiedad de Kevin Roldán y Judith Sancerni
  </footer>

  <script defer>
    (() => {
      const splashScreen = document.getElementById('splash-screen');
      const playerSetup = document.getElementById('player-setup');
      const categorySetup = document.getElementById('category-setup');
      const gameScreen = document.getElementById('game-screen');
      const addPlayerBtn = document.getElementById('add-player');
      const playersForm = document.getElementById('players-form');
      const categoriesForm = document.getElementById('categories-form');
      const startGameBtn = document.getElementById('start-game');
      const newQuestionBtn = document.getElementById('new-question');
      const questionEl = document.getElementById('question');
      const emojiEl = document.getElementById('emoji');
      const playerScoresEl = document.getElementById('player-scores');
      const selectAllCheckbox = document.getElementById('select-all');

      let players = [];
      let filteredQuestions = [];
      const maxPlayers = 12;
      const maxScore = 100;
      const usedQuestions = new Set();

      const questions = [
        { text: "¿Qué significa el amor para ti?", emoji: "❤️", category: "love" },
        { text: "¿En qué crees que se basa el amor a primera vista?", emoji: "❤️", category: "love" },
        { text: "¿Qué fue lo que más te molestó de tu primer amor?", emoji: "❤️", category: "love" },
        { text: "Si fueras invisible por un día, ¿qué harías?", emoji: "🔥", category: "sexual" },
        { text: "¿Cómo te sentirías si pillaras a tu pareja dándose autoplacer?", emoji: "🔥", category: "sexual" }
      ];

      // Mostrar pantalla de selección jugadores tras splash
      setTimeout(() => {
        splashScreen.classList.add('hidden');
        playerSetup.classList.remove('hidden');
        playerSetup.classList.add('animate-zoom-in');
        playerSetup.querySelector('input').focus();
      }, 3000);

      // Añadir jugador input
      addPlayerBtn.addEventListener('click', () => {
        const currentCount = playersForm.querySelectorAll('input[name="player"]').length;
        if (currentCount < maxPlayers) {
          const input = document.createElement('input');
          input.type = 'text';
          input.name = 'player';
          input.placeholder = `Nombre ${currentCount + 1}`;
          input.className = 'player-name rounded px-4 py-2 w-full text-black';
          input.autocomplete = "off";
          playersForm.insertBefore(input, addPlayerBtn);
          input.focus();
        } else {
          alert("¡No puedes añadir más de 12 jugadores!");
        }
      });

      // Control "¡Vamos a por todas!" para categorías
      selectAllCheckbox.addEventListener('change', e => {
        const checked = e.target.checked;
        categoriesForm.querySelectorAll('input.category-checkbox').forEach(cb => {
          cb.checked = checked;
        });
      });

      // Empezar juego: validar jugadores y mostrar categorías
      startGameBtn.addEventListener('click', () => {
        const inputs = playersForm.querySelectorAll('input[name="player"]');
        players = [];
        for (const input of inputs) {
          const val = input.value.trim();
          if (val) players.push({ name: val, score: 0 });
        }
        if (players.length === 0) {
          alert('Introduce al menos un nombre válido para comenzar');
          return;
        }
        playerSetup.classList.add('hidden');
        categorySetup.classList.remove('hidden');
        categorySetup.classList.add('animate-zoom-in');
      });

      // Aplicar categorías y empezar juego
      categoriesForm.addEventListener('submit', e => {
        e.preventDefault();
        const selected = Array.from(categoriesForm.querySelectorAll('input.category-checkbox:checked')).map(c => c.value);
        if (selected.length === 0) {
          alert('¡Por favor selecciona al menos una categoría!');
          return;
        }
        filteredQuestions = questions.filter(q => selected.includes(q.category));
        if (filteredQuestions.length === 0) {
          alert('¡No hay preguntas en las categorías seleccionadas!');
          return;
        }
        categorySetup.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        gameScreen.classList.add('animate-zoom-in');
        usedQuestions.clear();
        updateScores();
        showNewQuestion();
      });

      // Mostrar nueva pregunta
      newQuestionBtn.addEventListener('click', () => {
        showNewQuestion();
      });

      function showNewQuestion() {
        let available = filteredQuestions.filter(q => !usedQuestions.has(q.text));
        if (available.length === 0) {
          usedQuestions.clear();
          available = [...filteredQuestions];
        }
        const question = available[Math.floor(Math.random() * available.length)];
        usedQuestions.add(question.text);
        questionEl.textContent = question.text;
        emojiEl.textContent = question.emoji;
      }

      function updateScores() {
        playerScoresEl.innerHTML = '';
        players.forEach((player, i) => {
          const container = document.createElement('div');
          container.className = 'flex flex-col space-y-1';

          const info = document.createElement('div');
          info.className = 'flex justify-between items-center';

          const name = document.createElement('p');
          name.textContent = `${player.name.toUpperCase()}: ${player.score}`;
          name.className = 'font-semibold text-lg select-text';

          const btnGroup = document.createElement('div');
          btnGroup.className = 'flex space-x-3';

          const btnAdd = document.createElement('button');
          btnAdd.textContent = '➕';
          btnAdd.setAttribute('aria-label', `Sumar puntos a ${player.name}`);
          btnAdd.className = 'text-white text-xl hover:text-green-400 transition';
          btnAdd.addEventListener('click', () => changeScore(i, 10));

          const btnSub = document.createElement('button');
          btnSub.textContent = '➖';
          btnSub.setAttribute('aria-label', `Restar puntos a ${player.name}`);
          btnSub.className = 'text-white text-xl hover:text-red-400 transition';
          btnSub.addEventListener('click', () => changeScore(i, -10));

          btnGroup.append(btnSub, btnAdd);
          info.append(name, btnGroup);

          const progressContainer = document.createElement('div');
          progressContainer.className = 'bg-gray-700 rounded-full h-4 overflow-hidden';

          const progressBar = document.createElement('div');
          progressBar.className = 'bg-green-500 h-full transition-all duration-300 ease-in-out';
          progressBar.style.width = `${Math.min(100, (player.score / maxScore) * 100)}%`;

          progressContainer.appendChild(progressBar);
          container.append(info, progressContainer);
          playerScoresEl.appendChild(container);
        });
      }

      function changeScore(playerIndex, delta) {
        const player = players[playerIndex];
        const newScore = player.score + delta;
        if (newScore < 0) {
          alert('¡Ojo! La puntuación no puede ser menor a 0');
          return;
        }
        player.score = newScore;
        if (player.score >= maxScore) {
          alert(`${player.name} ha obtenido la mayor puntuación, pero todas habéis ganado 💜`);
          setTimeout(() => location.reload(), 3000);
          return;
        }
        updateScores();
      }

      // Evitar zoom con doble clic en móvil
      document.addEventListener('dblclick', e => e.preventDefault(), { passive: false });
    })();
  </script>
</body>
</html>
